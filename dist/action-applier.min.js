!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AutoRouterActionApplier=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function replacer(key,value){return util.isUndefined(value)?""+value:util.isNumber(value)&&!isFinite(value)?value.toString():util.isFunction(value)||util.isRegExp(value)?value.toString():value}function truncate(s,n){return util.isString(s)?s.length<n?s:s.slice(0,n):s}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected){if(actual===expected)return!0;if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return!1;for(var i=0;i<actual.length;i++)if(actual[i]!==expected[i])return!1;return!0}return util.isDate(actual)&&util.isDate(expected)?actual.getTime()===expected.getTime():util.isRegExp(actual)&&util.isRegExp(expected)?actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase:util.isObject(actual)||util.isObject(expected)?objEquiv(actual,expected):actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return!1;if(a.prototype!==b.prototype)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key]))return!1;return!0}function expectedException(actual,expected){return actual&&expected?"[object RegExp]"==Object.prototype.toString.call(expected)?expected.test(actual):actual instanceof expected?!0:expected.call({},actual)===!0?!0:!1:!1}function _throws(shouldThrow,block,expected,message){var actual;util.isString(expected)&&(message=expected,expected=null);try{block()}catch(e){actual=e}if(message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message),!shouldThrow&&expectedException(actual,expected)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}var util=require("util/"),pSlice=Array.prototype.slice,hasOwn=Object.prototype.hasOwnProperty,assert=module.exports=ok;assert.AssertionError=function(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=stackStartFunction.name,idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert["throws"]=function(block,error,message){_throws.apply(this,[!0].concat(pSlice.call(arguments)))},assert.doesNotThrow=function(block,message){_throws.apply(this,[!1].concat(pSlice.call(arguments)))},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}},{"util/":5}],2:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],3:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],4:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],5:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:3,inherits:2}],6:[function(require,module,exports){function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var args=arguments,useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0,lastC=0;return args[0].replace(/%[a-z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c),args}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}function localstorage(){try{return window.localStorage}catch(e){}}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){return JSON.stringify(v)},exports.enable(load())},{"./debug":7}],7:[function(require,module,exports){function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}function enabled(){var self=enabled,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,null==self.useColors&&(self.useColors=exports.useColors()),null==self.color&&self.useColors&&(self.color=selectColor());var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&(args=["%o"].concat(args));var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),"function"==typeof exports.formatArgs&&(args=exports.formatArgs.apply(self,args));var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}disabled.enabled=!1,enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;return fn.namespace=namespace,fn}function enable(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)split[i]&&(namespaces=split[i].replace(/\*/g,".*?"),"-"===namespaces[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;len>i;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;len>i;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}exports=module.exports=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime,prevColor=0},{ms:8}],8:[function(require,module,exports){function parse(str){if(str=""+str,!(str.length>1e4)){var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function short(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){return n>ms?void 0:1.5*n>ms?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){return options=options||{},"string"==typeof val?parse(val):options["long"]?long(val):short(val)}},{}],9:[function(require,module,exports){"use strict";var AutoRouter=require("./AutoRouter"),assert=require("./AutoRouter.Utils").assert,AutoRouterActionApplier=function(){};AutoRouterActionApplier.AutoRouter=AutoRouter,AutoRouterActionApplier.prototype.init=function(){this._portSeparator=this._portSeparator||"_x_",this.autorouter=new AutoRouter,this.debugActionSequence="[",this._clearRecords()},AutoRouterActionApplier.prototype._clearRecords=function(){this._autorouterBoxes={},this._autorouterPorts={},this._autorouterPaths={},this._arPathId2Original={}},AutoRouterActionApplier.prototype._lookupItem=function(dictionary,array,indices){for(var index,id,i=2;i<arguments.length;i++)index=arguments[i],id=array[index],array[index]=dictionary[id]},AutoRouterActionApplier.prototype._fixArgs=function(command,args){var id;switch(command){case"move":this._lookupItem(this._autorouterBoxes,args,0),args[0]=args[0].box;break;case"getPathPoints":this._lookupItem(this._autorouterPaths,args,0);break;case"setPathCustomPoints":id=args[0].path,args[0].path=this._autorouterPaths[id];break;case"setBoxRect":this._lookupItem(this._autorouterBoxes,args,0);break;case"getBoxRect":this._lookupItem(this._autorouterBoxes,args,0),args[0]=args[0].box.id;break;case"updatePort":this._lookupItem(this._autorouterBoxes,args,0);break;case"setComponent":this._lookupItem(this._autorouterBoxes,args,0,1);break;case"addPath":this._fixPortArgs(args[0].src,args[0].dst),args.pop();break;case"remove":var item;id=args[0],this._autorouterBoxes[id]?item=this._autorouterBoxes[id]:this._autorouterPaths[id]&&(item=this._autorouterPaths[id]),args[0]=item;break;case"addBox":args.pop()}},AutoRouterActionApplier.prototype._fixPortArgs=function(port1,port2){for(var portId,portIds,arPortId,boxId,ports,i=arguments.length;i--;){ports=arguments[i],portIds=Object.keys(ports);for(var j=portIds.length;j--;)portId=portIds[j],boxId=ports[portId],arPortId=this.autorouter.getPortId(portId,this._autorouterBoxes[boxId]),ports[portId]=this._autorouterBoxes[boxId].ports[arPortId],assert(this._autorouterBoxes[boxId].ports[arPortId],"AR Port not found!")}},AutoRouterActionApplier.prototype._invokeAutoRouterMethod=function(command,args){try{return this._invokeAutoRouterMethodUnsafe(command,args)}catch(e){this.logger.error("AutoRouter."+command+" failed with error: "+e)}},AutoRouterActionApplier.prototype._invokeAutoRouterMethodUnsafe=function(command,args){var result,oldArgs=args.slice();return this._recordActions&&this._recordAction(command,args.slice()),this._fixArgs(command,args),result=this.autorouter[command].apply(this.autorouter,args),this._updateRecords(command,oldArgs,result),result},AutoRouterActionApplier.prototype._updateRecords=function(command,input,result){assert(input instanceof Array);var id,i,args=input.slice();switch(command){case"addPath":id=args.pop(),this._autorouterPaths[id]=result,this._arPathId2Original[result]=id;break;case"addBox":id=args.pop(),this._autorouterBoxes[id]=result,this._autorouterPorts[id]=[];var ids=Object.keys(result.ports);for(i=ids.length;i--;)this._autorouterPorts[id].push(result.ports[ids[i]]);break;case"remove":if(id=args[0],this._autorouterBoxes[id]){for(i=this._autorouterPorts[id]?this._autorouterPorts[id].length:0;i--;){var portId=id+this._portSeparator+this._autorouterPorts[id][i];delete this._autorouterBoxes[portId]}delete this._autorouterBoxes[id],delete this._autorouterPorts[id]}else if(this._autorouterPaths[id]){var arId=this._autorouterPaths[id];delete this._autorouterPaths[id],delete this._arPathId2Original[arId]}break;case"setComponent":var len,subCompId;id=args[0],len=id.length+this._portSeparator.length,subCompId=args[1].substring(len),-1===this._autorouterPorts[id].indexOf(subCompId)&&this._autorouterPorts[id].push(subCompId);break;case"updatePort":id=args[1].id}},AutoRouterActionApplier.prototype._recordAction=function(command,args){var action={action:command,args:args},circularFixer=function(key,value){return value&&value.owner?value.id:value};this.debugActionSequence+=JSON.stringify(action,circularFixer)+","},AutoRouterActionApplier.prototype._getActionSequence=function(){var index=this.debugActionSequence.lastIndexOf(","),result=this.debugActionSequence.substring(0,index)+"]";return result},module.exports=AutoRouterActionApplier},{"./AutoRouter":23,"./AutoRouter.Utils":22}],10:[function(require,module,exports){"use strict";var assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),ArPoint=require("./AutoRouter.Point"),ArRect=require("./AutoRouter.Rect"),AutoRouterPort=require("./AutoRouter.Port"),AutoRouterBox=function(){this.owner=null,this.rect=new ArRect,this.atomic=!1,this.selfPoints=[],this.ports=[],this.childBoxes=[],this.parent=null,this.id=null,this.calculateSelfPoints()};AutoRouterBox.prototype.calculateSelfPoints=function(){this.selfPoints=[],this.selfPoints.push(new ArPoint(this.rect.getTopLeft())),this.selfPoints.push(new ArPoint(this.rect.right,this.rect.ceil)),this.selfPoints.push(new ArPoint(this.rect.right,this.rect.floor)),this.selfPoints.push(new ArPoint(this.rect.left,this.rect.floor))},AutoRouterBox.prototype.deleteAllPorts=function(){for(var i=0;i<this.ports.length;i++)this.ports[i].destroy();this.ports=[],this.atomic=!1},AutoRouterBox.prototype.hasOwner=function(){return null!==this.owner},AutoRouterBox.prototype.createPort=function(){var port=new AutoRouterPort;return assert(null!==port,"ARBox.createPort: port !== null FAILED"),port},AutoRouterBox.prototype.hasNoPort=function(){return 0===this.ports.length},AutoRouterBox.prototype.isAtomic=function(){return this.atomic},AutoRouterBox.prototype.addPort=function(port){assert(null!==port,"ARBox.addPort: port !== null FAILED"),port.owner=this,this.ports.push(port),this.owner&&this.owner._addEdges(port)},AutoRouterBox.prototype.deletePort=function(port){if(assert(null!==port,"ARBox.deletePort: port !== null FAILED"),null!==port){var index=this.ports.indexOf(port),graph=this.owner;assert(-1!==index,"ARBox.deletePort: index !== -1 FAILED"),graph.deleteEdges(port),this.ports.splice(index,1),this.atomic=!1}},AutoRouterBox.prototype.isRectEmpty=function(){return this.rect.isRectEmpty()},AutoRouterBox.prototype.setRect=function(r){assert(r instanceof ArRect,"Invalthis.id arg in ARBox.setRect. Requires ArRect"),assert(r.getWidth()>=3&&r.getHeight()>=3,"ARBox.setRect: r.getWidth() >= 3 && r.getHeight() >= 3 FAILED!"),assert(r.getTopLeft().x>=CONSTANTS.ED_MINCOORD&&r.getTopLeft().y>=CONSTANTS.ED_MINCOORD,"ARBox.setRect: r.getTopLeft().x >= CONSTANTS.ED_MINCOORD && r.getTopLeft().y >= CONSTANTS.ED_MAXCOORD FAILED!"),assert(r.getBottomRight().x<=CONSTANTS.ED_MAXCOORD&&r.getBottomRight().y<=CONSTANTS.ED_MAXCOORD,"ARBox.setRect:  r.getBottomRight().x <= CONSTANTS.ED_MAXCOORD && r.getBottomRight().y <= CONSTANTS.ED_MAXCOORD FAILED!"),assert(0===this.ports.length||this.atomic,"ARBox.setRect: this.ports.length === 0 || this.atomic FAILED!"),this.rect.assign(r),this.calculateSelfPoints(),this.atomic&&(assert(1===this.ports.length,"ARBox.setRect: this.ports.length === 1 FAILED!"),this.ports[0].setRect(r))},AutoRouterBox.prototype.shiftBy=function(offset){this.rect.add(offset);for(var i=this.ports.length;i--;)this.ports[i].shiftBy(offset);this.calculateSelfPoints()},AutoRouterBox.prototype.resetPortAvailability=function(){for(var i=this.ports.length;i--;)this.ports[i].resetAvailableArea()},AutoRouterBox.prototype.adjustPortAvailability=function(box){if(!box.hasAncestorWithId(this.id)&&!this.hasAncestorWithId(box.id))for(var i=this.ports.length;i--;)this.ports[i].adjustAvailableArea(box.rect)},AutoRouterBox.prototype.addChild=function(box){assert(-1===this.childBoxes.indexOf(box),"ARBox.addChild: box already is child of "+this.id),assert(box instanceof AutoRouterBox,"Child box must be of type AutoRouterBox"),this.childBoxes.push(box),box.parent=this},AutoRouterBox.prototype.removeChild=function(box){var i=this.childBoxes.indexOf(box);assert(-1!==i,"ARBox.removeChild: box isn't child of "+this.id),this.childBoxes.splice(i,1),box.parent=null},AutoRouterBox.prototype.hasAncestorWithId=function(id){for(var box=this;box;){if(box.id===id)return!0;box=box.parent}return!1},AutoRouterBox.prototype.getRootBox=function(){for(var box=this;box.parent;)box=box.parent;return box},AutoRouterBox.prototype.isBoxAt=function(point,nearness){return Utils.isPointIn(point,this.rect,nearness)},AutoRouterBox.prototype.isBoxClip=function(r){return Utils.isRectClip(this.rect,r)},AutoRouterBox.prototype.isBoxIn=function(r){return Utils.isRectIn(this.rect,r)},AutoRouterBox.prototype.destroy=function(){var i=this.childBoxes.length;for(this.parent&&this.parent.removeChild(this),this.owner=null,this.deleteAllPorts();i--;)this.childBoxes[i].destroy()},AutoRouterBox.prototype.assertValid=function(){for(var p=this.ports.length;p--;)this.ports[p].assertValid()},module.exports=AutoRouterBox},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Port":19,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}],11:[function(require,module,exports){"use strict";var ArPoint=require("./AutoRouter.Point");module.exports={EMPTY_POINT:new ArPoint(-1e5,-1e5),ED_MAXCOORD:1e5,ED_MINCOORD:-2,ED_SMALLGAP:15,CONNECTIONCUSTOMIZATIONDATAVERSION:0,EMPTYCONNECTIONCUSTOMIZATIONDATAMAGIC:-1,DEBUG:!1,BUFFER:10,EDLS_S:15,EDLS_R:16,EDLS_D:1e5+2,PathEndOnDefault:0,PathEndOnTop:16,PathEndOnRight:32,PathEndOnBottom:64,PathEndOnLeft:128,PathEndMask:240,PathStartOnDefault:0,PathStartOnTop:256,PathStartOnRight:512,PathStartOnBottom:1024,PathStartOnLeft:2048,PathStartMask:3840,PathHighLighted:2,PathFixed:1,PathDefault:0,PathStateConnected:1,PathStateDefault:0,PortEndOnTop:1,PortEndOnRight:2,PortEndOnBottom:4,PortEndOnLeft:8,PortEndOnAll:15,PortStartOnTop:16,PortStartOnRight:32,PortStartOnBottom:64,PortStartOnLeft:128,PortStartOnAll:240,PortConnectOnAll:255,PortConnectToCenter:256,PortStartEndHorizontal:170,PortStartEndVertical:85,PortDefault:255,DirNone:-1,DirTop:0,DirRight:1,DirBottom:2,DirLeft:3,DirSkew:4,SimpleEdgeDisplacement:"EdgeDisplacement",CustomPointCustomization:"PointCustomization"}},{"./AutoRouter.Point":17}],12:[function(require,module,exports){"use strict";var assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),ArPoint=require("./AutoRouter.Point"),AutoRouterEdge=function(){this.owner=null,this.startpointPrev=null,this.startpoint=null,this.endpoint=null,this.endpointNext=null,this.positionY=0,this.positionX1=0,this.positionX2=0,this.bracketClosing=!1,this.bracketOpening=!1,this.orderPrev=null,this.orderNext=null,this.sectionX1=null,
this.sectionX2=null,this.sectionNext=null,this.sectionDown=null,this.edgeFixed=!1,this.edgeCustomFixed=!1,this.edgeCanPassed=!1,this.edgeDirection=null,this.blockPrev=null,this.blockNext=null,this.blockTrace=null,this.closestPrev=null,this.closestNext=null};AutoRouterEdge.prototype.assign=function(otherEdge){return null!==otherEdge?(this.owner=otherEdge.owner,this.setStartPoint(otherEdge.startpoint,!1),this.setEndPoint(otherEdge.endpoint,null!==otherEdge.endpoint),this.startpointPrev=otherEdge.startpointPrev,this.endpointNext=otherEdge.endpointNext,this.positionY=otherEdge.positionY,this.positionX1=otherEdge.positionX1,this.positionX2=otherEdge.positionX2,this.bracketClosing=otherEdge.bracketClosing,this.bracketOpening=otherEdge.bracketOpening,this.orderNext=otherEdge.orderNext,this.orderPrev=otherEdge.orderPrev,this.sectionX1=otherEdge.sectionX1,this.sectionX2=otherEdge.sectionX2,this.setSectionNext(otherEdge.getSectionNext(!0)),this.setSectionDown(otherEdge.getSectionDown(!0)),this.edgeFixed=otherEdge.edgeFixed,this.edgeCustomFixed=otherEdge.edgeCustomFixed,this.setEdgeCanpassed(otherEdge.getEdgeCanpassed()),this.setDirection(otherEdge.getDirection()),this.setBlockPrev(otherEdge.getBlockPrev()),this.setBlockNext(otherEdge.getBlockNext()),this.setBlockTrace(otherEdge.getBlockTrace()),this.setClosestPrev(otherEdge.getClosestPrev()),this.setClosestNext(otherEdge.getClosestNext()),this):null},AutoRouterEdge.prototype.equals=function(otherEdge){return this===otherEdge},AutoRouterEdge.prototype.getStartPointPrev=function(){return null!==this.startpointPrev?this.startpointPrev||this.startpointPrev:null},AutoRouterEdge.prototype.isStartPointPrevNull=function(){return!this.startpointPrev},AutoRouterEdge.prototype.getStartPoint=function(){return null!==this.startpoint?new ArPoint(this.startpoint instanceof Array?this.startpoint:this.startpoint):CONSTANTS.EMPTY_POINT},AutoRouterEdge.prototype.isSameStartPoint=function(point){return this.startpoint===point},AutoRouterEdge.prototype.isStartPointNull=function(){return null===this.startpoint},AutoRouterEdge.prototype.setStartPoint=function(point,b){this.startpoint=point,b!==!1&&this.recalculateDirection()},AutoRouterEdge.prototype.setStartPointX=function(_x){this.startpoint.x=_x},AutoRouterEdge.prototype.setStartPointY=function(_y){this.startpoint.y=_y},AutoRouterEdge.prototype.getEndPoint=function(){return null!==this.endpoint?new ArPoint(this.endpoint instanceof Array?this.endpoint:this.endpoint):CONSTANTS.EMPTY_POINT},AutoRouterEdge.prototype.isEndPointNull=function(){return null===this.endpoint},AutoRouterEdge.prototype.setEndPoint=function(point,b){this.endpoint=point,b!==!1&&this.recalculateDirection()},AutoRouterEdge.prototype.setStartAndEndPoint=function(startPoint,endPoint){this.setStartPoint(startPoint,!1),this.setEndPoint(endPoint)},AutoRouterEdge.prototype.setEndPointX=function(_x){this.endpoint.x=_x},AutoRouterEdge.prototype.setEndPointY=function(_y){this.endpoint.y=_y},AutoRouterEdge.prototype.isEndPointNextNull=function(){return!this.endpointNext},AutoRouterEdge.prototype.getSectionNext=function(){return void 0!==this.sectionNext?this.sectionNext[0]:null},AutoRouterEdge.prototype.getSectionNextPtr=function(){return this.sectionNext&&this.sectionNext[0]||(this.sectionNext=[new AutoRouterEdge]),this.sectionNext},AutoRouterEdge.prototype.setSectionNext=function(nextSection){nextSection=nextSection instanceof Array?nextSection[0]:nextSection,this.sectionNext instanceof Array?this.sectionNext[0]=nextSection:this.sectionNext=[nextSection]},AutoRouterEdge.prototype.getSectionDown=function(){return void 0!==this.sectionDown?this.sectionDown[0]:null},AutoRouterEdge.prototype.getSectionDownPtr=function(){return this.sectionDown&&this.sectionDown[0]||(this.sectionDown=[new AutoRouterEdge]),this.sectionDown},AutoRouterEdge.prototype.setSectionDown=function(downSection){downSection=downSection instanceof Array?downSection[0]:downSection,this.sectionDown instanceof Array?this.sectionDown[0]=downSection:this.sectionDown=[downSection]},AutoRouterEdge.prototype.getEdgeCanpassed=function(){return this.edgeCanPassed},AutoRouterEdge.prototype.setEdgeCanpassed=function(ecp){this.edgeCanPassed=ecp},AutoRouterEdge.prototype.getDirection=function(){return this.edgeDirection},AutoRouterEdge.prototype.setDirection=function(dir){this.edgeDirection=dir},AutoRouterEdge.prototype.recalculateDirection=function(){assert(null!==this.startpoint&&null!==this.endpoint,"AREdge.recalculateDirection: this.startpoint !== null && this.endpoint !== null FAILED!"),this.edgeDirection=Utils.getDir(this.endpoint.minus(this.startpoint))},AutoRouterEdge.prototype.getBlockPrev=function(){return this.blockPrev},AutoRouterEdge.prototype.setBlockPrev=function(prevBlock){this.blockPrev=prevBlock},AutoRouterEdge.prototype.getBlockNext=function(){return this.blockNext},AutoRouterEdge.prototype.setBlockNext=function(nextBlock){this.blockNext=nextBlock},AutoRouterEdge.prototype.getBlockTrace=function(){return this.blockTrace},AutoRouterEdge.prototype.setBlockTrace=function(traceBlock){this.blockTrace=traceBlock},AutoRouterEdge.prototype.getClosestPrev=function(){return this.closestPrev},AutoRouterEdge.prototype.setClosestPrev=function(cp){this.closestPrev=cp},AutoRouterEdge.prototype.getClosestNext=function(){return this.closestNext},AutoRouterEdge.prototype.setClosestNext=function(cp){this.closestNext=cp},module.exports=AutoRouterEdge},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Utils":22,assert:1}],13:[function(require,module,exports){"use strict";var Logger=require("./AutoRouter.Logger"),assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),AutoRouterBox=(require("./AutoRouter.Path"),require("./AutoRouter.Port"),require("./AutoRouter.Box")),AutoRouterEdge=require("./AutoRouter.Edge"),_logger=new Logger("AutoRouter.EdgeList"),AutoRouterEdgeList=function(b){this.owner=null,this.ishorizontal=b,this.orderFirst=null,this.orderLast=null,this.sectionFirst=null,this.sectionBlocker=null,this.sectionPtr2Blocked=[],this._initOrder(),this._initSection()};AutoRouterEdgeList.prototype.contains=function(start,end){for(var startpoint,endpoint,currentEdge=this.orderFirst;currentEdge;){if(startpoint=currentEdge.startpoint,endpoint=currentEdge.endpoint,start.equals(startpoint)&&end.equals(endpoint))return!0;currentEdge=currentEdge.orderNext}return!1},AutoRouterEdgeList.prototype.destroy=function(){this.checkOrder(),this.checkSection()},AutoRouterEdgeList.prototype.addPathEdges=function(path){assert(path.owner===this.owner,"AREdgeList.addEdges: path.owner === owner FAILED!");var startpoint,endpoint,dir,edge,i,isPathAutoRouted=path.isAutoRouted(),hasCustomEdge=!1,customizedIndexes={},indexes=[];if(isPathAutoRouted)for(i=-1;++i<indexes.length;)hasCustomEdge=!0,customizedIndexes[indexes[i]]=0;else hasCustomEdge=!0;var indItr,goodAngle,skipEdge,isMoveable,isEdgeCustomFixed,startPort,endPort,isStartPortConnectToCenter,isEndPortConnectToCenter,isPathFixed,pointList=path.getPointList(),ptrsObject=pointList.getTailEdgePtrs(),currEdgeIndex=pointList.length-2,pos=ptrsObject.pos;for(startpoint=ptrsObject.start,endpoint=ptrsObject.end;pointList.length&&pos>=0;)dir=Utils.getDir(endpoint.minus(startpoint)),skipEdge=dir===CONSTANTS.DirNone?!0:!1,isMoveable=path.isMoveable(),isMoveable||dir===CONSTANTS.DirSkew||(goodAngle=Utils.isRightAngle(dir),assert(goodAngle,"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),goodAngle||(skipEdge=!0)),!skipEdge&&Utils.isRightAngle(dir)&&Utils.isHorizontal(dir)===this.ishorizontal&&(edge=new AutoRouterEdge,edge.owner=path,edge.setStartAndEndPoint(startpoint,endpoint),edge.startpointPrev=pointList.getPointBeforeEdge(pos),edge.endpointNext=pointList.getPointAfterEdge(pos),hasCustomEdge?(isEdgeCustomFixed=!1,isPathAutoRouted?(indItr=customizedIndexes.indexOf(currEdgeIndex),isEdgeCustomFixed=indItr!==customizedIndexes.length-1):isEdgeCustomFixed=!0,edge.edgeCustomFixed=isEdgeCustomFixed):edge.edgeCustomFixed=dir===CONSTANTS.DirSkew,startPort=path.getStartPort(),assert(null!==startPort,"AREdgeList.addEdges: startPort !== null FAILED!"),isStartPortConnectToCenter=startPort.isConnectToCenter(),endPort=path.getEndPort(),assert(null!==endPort,"AREdgeList.addEdges: endPort !== null FAILED!"),isEndPortConnectToCenter=endPort.isConnectToCenter(),isPathFixed=path.isFixed()||!path.isAutoRouted(),edge.edgeFixed=edge.edgeCustomFixed||isPathFixed||edge.isStartPointPrevNull()&&isStartPortConnectToCenter||edge.isEndPointNextNull()&&isEndPortConnectToCenter,dir!==CONSTANTS.DirSkew?(this._positionLoadY(edge),this._positionLoadB(edge)):(edge.positionY=0,edge.bracketOpening=!1,edge.bracketClosing=!1),this.insert(edge)),ptrsObject=pointList.getPrevEdgePtrs(pos),pos=ptrsObject.pos,startpoint=ptrsObject.start,endpoint=ptrsObject.end,currEdgeIndex--;return!0},AutoRouterEdgeList.prototype.addPortEdges=function(port){var startpoint,endpoint,edge,selfPoints,startpointPrev,endpointNext,dir,i,canHaveStartEndPointHorizontal;if(assert(port.owner.owner===this.owner,"AREdgeList.addEdges: port.owner === (owner) FAILED!"),!port.isConnectToCenter()&&!port.owner.isAtomic())for(selfPoints=port.selfPoints,i=0;4>i;i++)startpointPrev=selfPoints[(i+3)%4],startpoint=selfPoints[i],endpoint=selfPoints[(i+1)%4],endpointNext=selfPoints[(i+2)%4],dir=Utils.getDir(endpoint.minus(startpoint)),assert(Utils.isRightAngle(dir),"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),canHaveStartEndPointHorizontal=port.canHaveStartEndPointHorizontal(this.ishorizontal),Utils.isHorizontal(dir)===this.ishorizontal&&canHaveStartEndPointHorizontal&&(edge=new AutoRouterEdge,edge.owner=port,edge.setStartAndEndPoint(startpoint,endpoint),edge.startpointPrev=startpointPrev,edge.endpointNext=endpointNext,edge.edgeFixed=!0,this._positionLoadY(edge),this._positionLoadB(edge),edge.bracketClosing&&edge.addToPosition(.999),this.insert(edge))},AutoRouterEdgeList.prototype.addEdges=function(path){var selfPoints,startpoint,startpointPrev,endpointNext,endpoint,edge,dir,i;if(path instanceof AutoRouterBox){var box=path;for(assert(box.owner===this.owner,"AREdgeList.addEdges: box.owner === (owner) FAILED!"),selfPoints=box.selfPoints,i=0;4>i;i++)startpointPrev=selfPoints[(i+3)%4],startpoint=selfPoints[i],endpoint=selfPoints[(i+1)%4],endpointNext=selfPoints[(i+2)%4],dir=Utils.getDir(endpoint.minus(startpoint)),assert(Utils.isRightAngle(dir),"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),Utils.isHorizontal(dir)===this.ishorizontal&&(edge=new AutoRouterEdge,edge.owner=box,edge.setStartAndEndPoint(startpoint,endpoint),edge.startpointPrev=startpointPrev,edge.endpointNext=endpointNext,edge.edgeFixed=!0,this._positionLoadY(edge),this._positionLoadB(edge),edge.bracketClosing&&edge.addToPosition(.999),this.insert(edge))}else if(path){var graph=path;for(assert(graph===this.owner,"AREdgeList.addEdges: graph === this.owner FAILED!"),selfPoints=graph.selfPoints,i=0;4>i;i++)startpointPrev=selfPoints[(i+3)%4],startpoint=selfPoints[i],endpoint=selfPoints[(i+1)%4],endpointNext=selfPoints[(i+2)%4],dir=Utils.getDir(endpoint.minus(startpoint)),assert(Utils.isRightAngle(dir),"AREdgeList.addEdges: Utils.isRightAngle (dir) FAILED!"),Utils.isHorizontal(dir)===this.ishorizontal&&(edge=new AutoRouterEdge,edge.owner=graph,edge.setStartAndEndPoint(startpoint,endpoint),edge.startpointPrev=startpointPrev,edge.endpointNext=endpointNext,edge.edgeFixed=!0,this._positionLoadY(edge),this.insert(edge))}},AutoRouterEdgeList.prototype.deleteEdges=function(object){for(var next,edge=this.orderFirst;null!==edge;)edge.owner===object?(next=edge.orderNext,this.remove(edge),edge=next):edge=edge.orderNext},AutoRouterEdgeList.prototype.deleteAllEdges=function(){for(;this.orderFirst;)this.remove(this.orderFirst)},AutoRouterEdgeList.prototype.getEdge=function(path,startpoint){for(var edge=this.orderFirst;null!==edge&&!edge.isSameStartPoint(startpoint);)edge=edge.orderNext;return assert(null!==edge,"AREdgeList.getEdge: edge !== null FAILED!"),edge},AutoRouterEdgeList.prototype.getEdgeByPointer=function(startpoint){for(var edge=this.orderFirst;null!==edge&&!edge.isSameStartPoint(startpoint);)edge=edge.orderNext;return assert(null!==edge,"AREdgeList.getEdgeByPointer: edge !== null FAILED!"),edge},AutoRouterEdgeList.prototype.setEdgeByPointer=function(pEdge,newEdge){assert(newEdge instanceof AutoRouterEdge,"AREdgeList.setEdgeByPointer: newEdge instanceof AutoRouterEdge FAILED!");for(var edge=this.sectionFirst;null!==edge&&pEdge!==edge;)edge=edge.getSectionDown();assert(null!==edge,"AREdgeList.setEdgeByPointer: edge !== null FAILED!"),edge=newEdge},AutoRouterEdgeList.prototype.getEdgeAt=function(point,nearness){for(var edge=this.orderFirst;edge;){if(Utils.isPointNearLine(point,edge.startpoint,edge.endpoint,nearness))return edge;edge=edge.orderNext}return null},AutoRouterEdgeList.prototype.dumpEdges=function(msg,logger){var edge=this.orderFirst,log=logger||_logger.debug,total=1;for(log(msg);null!==edge;)log("	"+edge.startpoint.x+", "+edge.startpoint.y+"		"+edge.endpoint.x+", "+edge.endpoint.y+"			("+(edge.edgeFixed?"FIXED":"MOVEABLE")+")		"+(edge.bracketClosing?"Bracket Closing":edge.bracketOpening?"Bracket Opening":"")),edge=edge.orderNext,total++;log("Total Edges: "+total)},AutoRouterEdgeList.prototype.getEdgeCount=function(){for(var edge=this.orderFirst,total=1;null!==edge;)edge=edge.orderNext,total++;return total},AutoRouterEdgeList.prototype._positionGetRealY=function(edge,y){return void 0===y?this.ishorizontal?(assert(edge.startpoint.y===edge.endpoint.y,"AREdgeList.position_GetRealY: edge.startpoint.y === edge.endpoint.y FAILED!"),edge.startpoint.y):(assert(edge.startpoint.x===edge.endpoint.x,"AREdgeList.position_GetRealY: edge.startpoint.x === edge.endpoint.x FAILED!"),edge.startpoint.x):(assert(null!==edge&&!edge.isStartPointNull()&&!edge.isEndPointNull(),"AREdgeList.position_GetRealY: edge !== null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED!"),void(this.ishorizontal?(assert(edge.startpoint.y===edge.endpoint.y,"AREdgeList.position_GetRealY: edge.startpoint.y === edge.endpoint.y FAILED!"),edge.setStartPointY(y),edge.setEndPointY(y)):(assert(edge.startpoint.x===edge.endpoint.x,"AREdgeList.position_GetRealY: edge.startpoint.x === edge.endpoint.x FAILED"),edge.setStartPointX(y),edge.setEndPointX(y))))},AutoRouterEdgeList.prototype._positionSetRealY=function(edge,y){edge instanceof Array&&(edge=edge[0]),assert(null!==edge&&!edge.isStartPointNull()&&!edge.isEndPointNull(),"AREdgeList.position_SetRealY: edge != null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED"),this.ishorizontal?(assert(edge.startpoint.y===edge.endpoint.y,"AREdgeList.position_SetRealY: edge.startpoint.y === edge.endpoint.y FAILED"),edge.setStartPointY(y),edge.setEndPointY(y)):(assert(edge.startpoint.x===edge.endpoint.x,"AREdgeList.position_SetRealY: edge.startpoint.x === edge.endpoint.x FAILED"),edge.setStartPointX(y),edge.setEndPointX(y))},AutoRouterEdgeList.prototype._positionGetRealX=function(edge){assert(null!==edge&&!edge.isStartPointNull()&&!edge.isEndPointNull(),"AREdgeList.position_GetRealX: edge !== null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var x1,x2;return this.ishorizontal?(assert(edge.startpoint.y===edge.endpoint.y,"AREdgeList.position_GetRealX: edge.startpoint.y === edge.endpoint.y FAILED"),edge.startpoint.x<edge.endpoint.x?(x1=edge.startpoint.x,x2=edge.endpoint.x):(x1=edge.endpoint.x,x2=edge.startpoint.x)):(assert(edge.startpoint.x===edge.endpoint.x,"AREdgeList.position_GetRealX: edge.startpoint.x === edge.endpoint.x FAILED"),edge.startpoint.y<edge.endpoint.y?(x1=edge.startpoint.y,x2=edge.endpoint.y):(x1=edge.endpoint.y,x2=edge.startpoint.y)),[x1,x2]},AutoRouterEdgeList.prototype._positionGetRealO=function(edge){assert(null!==edge&&!edge.isStartPointNull()&&!edge.isEndPointNull(),"AREdgeList.position_GetRealO: edge !== null && !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var o1,o2;return this.ishorizontal?(assert(edge.startpoint.y===edge.endpoint.y,"AREdgeList.position_GetRealO: edge.startpoint.y === edge.endpoint.y FAILED"),edge.startpoint.x<edge.endpoint.x?(o1=edge.isStartPointPrevNull()?0:edge.startpointPrev.y-edge.startpoint.y,o2=edge.isEndPointNextNull()?0:edge.endpointNext.y-edge.endpoint.y):(o1=edge.isEndPointNextNull()?0:edge.endpointNext.y-edge.endpoint.y,o2=edge.isStartPointPrevNull()?0:edge.startpointPrev.y-edge.startpoint.y)):(assert(edge.startpoint.x===edge.endpoint.x,"AREdgeList.position_GetRealO: edge.startpoint.x === edge.endpoint.x FAILED"),edge.startpoint.y<edge.endpoint.y?(o1=edge.isStartPointPrevNull()?0:edge.startpointPrev.x-edge.startpoint.x,o2=edge.isEndPointNextNull()?0:edge.endpointNext.x-edge.endpoint.x):(o1=edge.isEndPointNextNull()?0:edge.endpointNext.x-edge.endpoint.x,o2=edge.isStartPointPrevNull()?0:edge.startpointPrev.x-edge.startpoint.x)),[o1,o2]},AutoRouterEdgeList.prototype._positionLoadY=function(edge){assert(null!==edge&&null===edge.orderNext&&null===edge.orderPrev,"AREdgeList.position_LoadY: edge !== null && edge.orderNext === null && edge.orderPrev === null FAILED"),edge.positionY=this._positionGetRealY(edge)},AutoRouterEdgeList.prototype._positionLoadB=function(edge){assert(null!==edge,"AREdgeList.position_LoadB: edge !== null FAILED"),edge.bracketOpening=!edge.edgeFixed&&this._bracketIsOpening(edge),edge.bracketClosing=!edge.edgeFixed&&this._bracketIsClosing(edge)},AutoRouterEdgeList.prototype._positionAllStoreY=function(){for(var edge=this.orderFirst;edge;)this._positionSetRealY(edge,edge.positionY),edge=edge.orderNext},AutoRouterEdgeList.prototype._positionAllLoadX=function(){for(var pts,edge=this.orderFirst;edge;)pts=this._positionGetRealX(edge),edge.positionX1=pts[0],edge.positionX2=pts[1],edge=edge.orderNext},AutoRouterEdgeList.prototype._initOrder=function(){this.orderFirst=null,this.orderLast=null},AutoRouterEdgeList.prototype._checkOrder=function(){assert(null===this.orderFirst&&null===this.orderLast,"AREdgeList.checkOrder: this.orderFirst === null && this.orderLast === null FAILED")},AutoRouterEdgeList.prototype.insertBefore=function(edge,before){assert(null!==edge&&null!==before&&edge!==before,"AREdgeList.insertBefore: edge !== null && before !== null && edge !== before FAILED"),assert(null===edge.orderNext&&null===edge.orderPrev,"AREdgeList.insertBefore: edge.orderNext === null && edge.orderPrev === null FAILED"),edge.orderPrev=before.orderPrev,edge.orderNext=before,before.orderPrev?(assert(before.orderPrev.orderNext===before,"AREdgeList.insertBefore: before.orderPrev.orderNext === before FAILED\nbefore.orderPrev.orderNext is "+before.orderPrev.orderNext+" and before is "+before),before.orderPrev.orderNext=edge,assert(this.orderFirst!==before,"AREdgeList.insertBefore: this.orderFirst !== before FAILED")):(assert(this.orderFirst===before,"AREdgeList.insertBefore: this.orderFirst === before FAILED"),this.orderFirst=edge),before.orderPrev=edge},AutoRouterEdgeList.prototype.insertAfter=function(edge,after){assert(null!==edge&&null!==after&&!edge.equals(after),"AREdgeList.insertAfter:  edge !== null && after !== null && !edge.equals(after) FAILED"),assert(null===edge.orderNext&&null===edge.orderPrev,"AREdgeList.insertAfter: edge.orderNext === null && edge.orderPrev === null FAILED "),edge.orderNext=after.orderNext,edge.orderPrev=after,after.orderNext?(assert(after.orderNext.orderPrev.equals(after),"AREdgeList.insertAfter:  after.orderNext.orderPrev.equals(after) FAILED"),after.orderNext.orderPrev=edge,assert(!this.orderLast.equals(after),"AREdgeList.insertAfter: !orderLast.equals(after) FAILED")):(assert(this.orderLast.equals(after),"AREdgeList.insertAfter: this.orderLast.equals(after) FAILED"),this.orderLast=edge),after.orderNext=edge},AutoRouterEdgeList.prototype.insertLast=function(edge){assert(null!==edge,"AREdgeList.insertLast: edge !== null FAILED"),assert(null===edge.orderPrev&&null===edge.orderNext,"AREdgeList.insertLast: edge.orderPrev === null && edge.orderNext === null FAILED"),edge.orderPrev=this.orderLast,this.orderLast?(assert(null===this.orderLast.orderNext,"AREdgeList.insertLast: this.orderLast.orderNext === null FAILED"),assert(null!==this.orderFirst,"AREdgeList.insertLast: this.orderFirst != null FAILED"),this.orderLast.orderNext=edge,this.orderLast=edge):(assert(null===this.orderFirst,"AREdgeList.insertLast:  this.orderFirst === null FAILED"),this.orderFirst=edge,this.orderLast=edge)},AutoRouterEdgeList.prototype.insert=function(edge){assert(null!==edge,"AREdgeList.insert:  edge !== null FAILED"),assert(null===edge.orderPrev&&null===edge.orderNext,"AREdgeList.insert: edge.orderPrev === null && edge.orderNext === null FAILED");var y=edge.positionY;assert(CONSTANTS.ED_MINCOORD<=y&&y<=CONSTANTS.ED_MAXCOORD,"AREdgeList.insert: CONSTANTS.ED_MINCOORD <= y && y <= CONSTANTS.ED_MAXCOORD FAILED (y is "+y+")");for(var insert=this.orderFirst;insert&&insert.positionY<y;)insert=insert.orderNext;insert?this.insertBefore(edge,insert):this.insertLast(edge)},AutoRouterEdgeList.prototype.remove=function(edge){assert(null!==edge,"AREdgeList.remove:  edge !== null FAILED"),this.orderFirst===edge&&(this.orderFirst=edge.orderNext),edge.orderNext&&(edge.orderNext.orderPrev=edge.orderPrev),this.orderLast===edge&&(this.orderLast=edge.orderPrev),edge.orderPrev&&(edge.orderPrev.orderNext=edge.orderNext),edge.orderNext=null,edge.orderPrev=null},AutoRouterEdgeList.prototype._slideButNotPassEdges=function(edge,y){assert(null!==edge,"AREdgeList.slideButNotPassEdges: edge != null FAILED"),assert(CONSTANTS.ED_MINCOORD<y&&y<CONSTANTS.ED_MAXCOORD,"AREdgeList.slideButNotPassEdges: CONSTANTS.ED_MINCOORD < y && y < CONSTANTS.ED_MAXCOORD FAILED");var oldy=edge.positionY;if(assert(CONSTANTS.ED_MINCOORD<oldy&&oldy<CONSTANTS.ED_MAXCOORD,"AREdgeList.slideButNotPassEdges: CONSTANTS.ED_MINCOORD < oldy && oldy < CONSTANTS.ED_MAXCOORD FAILED"),oldy===y)return null;var x1=edge.positionX1,x2=edge.positionX2,ret=null,insert=edge;if(y>oldy){for(;insert.orderNext&&(insert=insert.orderNext,!(y<insert.positionY));)if(!insert.getEdgeCanpassed()&&Utils.intersect(x1,x2,insert.positionX1,insert.positionX2)){ret=insert,y=insert.positionY;break}edge!==insert&&insert.orderPrev!==edge&&(this.remove(edge),this.insertBefore(edge,insert))}else{for(;insert.orderPrev&&(insert=insert.orderPrev,!(y>insert.positionY));)if(!insert.getEdgeCanpassed()&&Utils.intersect(x1,x2,insert.positionX1,insert.positionX2)){ret=insert,y=insert.positionY;break}edge!==insert&&insert.orderNext!==edge&&(this.remove(edge),this.insertAfter(edge,insert))}return edge.positionY=y,ret},AutoRouterEdgeList.prototype._initSection=function(){this.sectionFirst=null,this.sectionBlocker=null,this.sectionPtr2Blocked=null},AutoRouterEdgeList.prototype.checkSection=function(){(null!==this.sectionBlocker||null!==this.sectionPtr2Blocked)&&(this._logger.warn("sectionBlocker and this.sectionPtr2Blocked are not null. Assuming last run did not exit cleanly. Fixing..."),this.sectionBlocker=null,this.sectionPtr2Blocked=null)},AutoRouterEdgeList.prototype.sectionReset=function(){this.checkSection(),this.sectionFirst=null},AutoRouterEdgeList.prototype._sectionBeginScan=function(blocker){this.checkSection(),this.sectionBlocker=blocker,this.sectionBlocker.sectionX1=this.sectionBlocker.positionX1,this.sectionBlocker.sectionX2=this.sectionBlocker.positionX2,this.sectionBlocker.setSectionNext(null),this.sectionBlocker.setSectionDown(null)},AutoRouterEdgeList.prototype._sectionIsImmediate=function(){assert(null!==this.sectionBlocker&&null!==this.sectionPtr2Blocked&&null!==this.sectionPtr2Blocked,"AREdgeList._sectionIsImmediate: this.sectionBlocker != null && this.sectionPtr2Blocked != null && *sectionPtr2Blocked != null FAILED");var sectionBlocked=this.sectionPtr2Blocked[0],e=sectionBlocked.getSectionDown(),a1=sectionBlocked.sectionX1,a2=sectionBlocked.sectionX2,p1=sectionBlocked.positionX1,p2=sectionBlocked.positionX2,b1=this.sectionBlocker.sectionX1,b2=this.sectionBlocker.sectionX2;if(null!==e&&(e=null===e.startpoint||void 0===e.sectionX1?null:e),assert(a2>=b1&&b2>=a1,"AREdgeList._sectionIsImmediate: b1 <= a2 && a1 <= b2 FAILED"),b1>=a1){for(;null!==e&&null!==e.startpoint&&e.sectionX2<b1;)e=e.getSectionNext();return a2>=b2?null===e||null===e.startpoint||b2<e.sectionX1:(null===e||null===e.startpoint)&&a2===p2}return a2>=b2?a1===p1&&(null===e||null===e.startpoint||b2<e.sectionX1):(null===e||null===e.startpoint)&&a1===p1&&a2===p2};var getLargerEndpoint=function(min,max){var result;return assert(max>min),result=Math.min(min+1,(min+max)/2),result===max&&(result=min),assert(max>result),result},getSmallerEndpoint=function(min,max){var result;return assert(max>min),result=Math.max(max-1,(min+max)/2),result===min&&(result=max),assert(result>min),result};AutoRouterEdgeList.prototype._sectionHasBlockedEdge=function(){assert(null!==this.sectionBlocker,"AREdgeList._sectionHasBlockedEdge: this.sectionBlocker != null FAILED");var newSectionX1,newSectionX2,e,blockerX1=this.sectionBlocker.sectionX1,blockerX2=this.sectionBlocker.sectionX2;if(assert(blockerX2>=blockerX1,"AREdgeList._sectionHasBlockedEdge: blockerX1 <= blockerX2 FAILED"),null===this.sectionPtr2Blocked)this.sectionFirst=null===this.sectionFirst?[new AutoRouterEdge]:this.sectionFirst,this.sectionPtr2Blocked=this.sectionFirst;else{var currentEdge=this.sectionPtr2Blocked[0];assert(null!==currentEdge.startpoint,"AREdgeList._sectionHasBlockedEdge: currentEdge.startpoint === null");var o=null;if(e=currentEdge.getSectionDownPtr()[0],newSectionX1=currentEdge.sectionX1,newSectionX2=currentEdge.sectionX2,assert(newSectionX2>=newSectionX1,"AREdgeList._sectionHasBlockedEdge: newSectionX1 <= newSectionX2 FAILED ("+newSectionX1+" <= "+newSectionX2+")\nedge is "),assert(newSectionX2>=blockerX1&&blockerX2>=newSectionX1,"AREdgeList._sectionHasBlockedEdge: blockerX1 <= newSectionX2 &&  newSectionX1 <= blockerX2 FAILED"),blockerX1>newSectionX1&&newSectionX2>blockerX2)this.sectionPtr2Blocked=currentEdge.getSectionDownPtr();else if(newSectionX1>=blockerX1&&blockerX2>=newSectionX2)if(e&&null!==e.startpoint){for(;e.getSectionNext()&&null!==e.getSectionNext().startpoint;)e=e.getSectionNext();e.setSectionNext(currentEdge.getSectionNext()),this.sectionPtr2Blocked[0]=currentEdge.getSectionDown()}else this.sectionPtr2Blocked[0]=currentEdge.getSectionNext();else if(newSectionX1>=blockerX1&&newSectionX2>blockerX2){for(assert(blockerX2>=newSectionX1,"AREdgeList._sectionHasBlockedEdge: newSectionX1 <= blockerX2 FAILED"),newSectionX1=getLargerEndpoint(blockerX2,newSectionX2);e&&null!==e.startpoint&&e.sectionX1<=newSectionX1;)assert(e.sectionX1<=e.sectionX2,"AREdgeList._sectionHasBlockedEdge: e.sectionX1 <= e.sectionX2 FAILED"),newSectionX1<=e.sectionX2&&(newSectionX1=getLargerEndpoint(e.sectionX2,newSectionX2)),o=e,e=e.getSectionNext();o&&(this.sectionPtr2Blocked[0]=currentEdge.getSectionDownPtr()[0],o.setSectionNext(currentEdge),currentEdge.setSectionDown(e)),assert(newSectionX1>blockerX2,"AREdgeList._sectionHasBlockedEdge: blockerX2 < newSectionX1 FAILED ("+blockerX2+" < "+newSectionX1+") "+currentEdge.sectionX2+" is "+newSectionX2+")"),currentEdge.sectionX1=newSectionX1,assert(currentEdge.sectionX1<currentEdge.sectionX2,"currentEdge.sectionX1 < currentEdge.sectionX2 ("+currentEdge.sectionX1+" < "+currentEdge.sectionX2+")")}else{for(assert(blockerX1>newSectionX1&&newSectionX2>=blockerX1&&blockerX2>=newSectionX2,"AREdgeList._sectionHasBlockedEdge:  newSectionX1 < blockerX1 && blockerX1 <= newSectionX2 && newSectionX2 <= blockerX2 FAILED"),this.sectionPtr2Blocked=currentEdge.getSectionDownPtr();e&&null!==e.startpoint;)o=e,e=e.getSectionNext(),o.sectionX2+1<blockerX1&&(null===e||null===e.startpoint||o.sectionX2+1<e.sectionX1)&&(this.sectionPtr2Blocked=o.getSectionNextPtr());if(null!==this.sectionPtr2Blocked[0].startpoint){assert(null!==o,"AREdgeList._sectionHasBlockedEdge: o != null FAILED"),o.setSectionNext(currentEdge.getSectionNext());var larger=blockerX1;this.sectionPtr2Blocked[0].sectionX1<blockerX1&&(larger=this.sectionPtr2Blocked[0].sectionX1),currentEdge.sectionX2=getSmallerEndpoint(newSectionX1,larger),currentEdge.setSectionNext(this.sectionPtr2Blocked[0]),this.sectionPtr2Blocked[0]=new AutoRouterEdge,this.sectionPtr2Blocked=null}else currentEdge.sectionX2=getSmallerEndpoint(newSectionX1,blockerX1);assert(currentEdge.sectionX1<currentEdge.sectionX2,"Expected sectionX1 < sectionX2 but "+currentEdge.sectionX1+" is not < "+currentEdge.sectionX2),this.sectionPtr2Blocked=currentEdge.getSectionNextPtr()}}for(assert(null!==this.sectionPtr2Blocked,"AREdgeList._sectionHasBlockedEdge: this.sectionPtr2Blocked != null FAILED");null!==this.sectionPtr2Blocked[0]&&null!==this.sectionPtr2Blocked[0].startpoint;)if(newSectionX1=this.sectionPtr2Blocked[0].sectionX1,newSectionX2=this.sectionPtr2Blocked[0].sectionX2,blockerX1>newSectionX2)this.sectionPtr2Blocked=this.sectionPtr2Blocked[0].getSectionNextPtr(),assert(null!==this.sectionPtr2Blocked,"AREdgeList._sectionHasBlockedEdge: this.sectionPtr2Blocked != null FAILED");else{if(newSectionX1>blockerX2)break;if(!(blockerX1>newSectionX1&&newSectionX2>blockerX2))return!0;var x=blockerX1;for(e=this.sectionPtr2Blocked[0].getSectionDown();;){if(null===e||null===e.startpoint||x<e.sectionX1)return!0;if(x<=e.sectionX2&&(x=e.sectionX2+1,x>blockerX2))break;e=e.getSectionNext()}this.sectionPtr2Blocked=this.sectionPtr2Blocked[0].getSectionDownPtr()}return assert(null===this.sectionBlocker.getSectionNext()&&(null===this.sectionBlocker.getSectionDown()||null===this.sectionBlocker.getSectionDown().startpoint),"AREdgeList._sectionHasBlockedEdge: this.sectionBlocker.getSectionNext() === null &&this.sectionBlocker.getSectionDown() === null FAILED"),this.sectionBlocker.setSectionNext(this.sectionPtr2Blocked[0]),this.sectionPtr2Blocked[0]=this.sectionBlocker,this.sectionBlocker=null,this.sectionPtr2Blocked=null,!1},AutoRouterEdgeList.prototype._sectionGetBlockedEdge=function(){return assert(null!==this.sectionBlocker&&null!==this.sectionPtr2Blocked,"AREdgeList.sectionGetBlockedEdge: this.sectionBlocker !== null && this.sectionPtr2Blocked !== null FAILED"),this.sectionPtr2Blocked[0]},AutoRouterEdgeList.prototype._bracketIsClosing=function(edge){assert(null!==edge,"AREdgeList._bracketIsClosing: edge !== null FAILED"),assert(!edge.isStartPointNull()&&!edge.isEndPointNull(),"AREdgeList._bracketIsClosing: !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var start=edge.startpoint,end=edge.endpoint;return edge.isStartPointPrevNull()||edge.isEndPointNextNull()?!1:this.ishorizontal?edge.startpointPrev.y<start.y&&edge.endpointNext.y<end.y:edge.startpointPrev.x<start.x&&edge.endpointNext.x<end.x},AutoRouterEdgeList.prototype._bracketIsOpening=function(edge){assert(null!==edge,"AREdgeList._bracketIsOpening: edge !== null FAILED"),assert(!edge.isStartPointNull()&&!edge.isEndPointNull(),"AREdgeList._bracketIsOpening: !edge.isStartPointNull() && !edge.isEndPointNull() FAILED");var prev,next,start=edge.startpoint||edge.startpoint,end=edge.endpoint||edge.endpoint;return edge.isStartPointPrevNull()||edge.isEndPointNextNull()?!1:(next=edge.endpointNext||edge.endpointNext,prev=edge.startpointPrev||edge.startpointPrev,this.ishorizontal?prev.y>start.y&&next.y>end.y:prev.x>start.x&&next.x>end.x)},AutoRouterEdgeList.prototype._bracketShouldBeSwitched=function(edge,next){assert(null!==edge&&null!==next,"AREdgeList._bracketShouldBeSwitched: edge !== null && next !== null FAILED");var c1,c2,ex=this._positionGetRealX(edge),ex1=ex[0],ex2=ex[1],eo=this._positionGetRealO(edge),eo1=eo[0],eo2=eo[1],nx=this._positionGetRealX(next),nx1=nx[0],nx2=nx[1],no=this._positionGetRealO(next),no1=no[0],no2=no[1];return c1=ex1>nx1&&nx2>ex1&&eo1>0||nx1>ex1&&ex2>nx1&&0>no1?1:ex1===nx1&&0===eo1&&0===no1?0:-9,c2=ex2>nx1&&nx2>ex2&&eo2>0||nx2>ex1&&ex2>nx2&&0>no2?1:ex2===nx2&&0===eo2&&0===no2?0:-9,c1+c2>0},AutoRouterEdgeList.prototype._blockGetF=function(d,b,s){var f=d/(b+s),S=CONSTANTS.EDLS_S,R=CONSTANTS.EDLS_R,D=CONSTANTS.EDLS_D;return 0===b&&f>=R?f+=D-R:f>S&&s>0&&(f=((D-S)*d-S*(D-R)*s)/((D-S)*b+(R-S)*s)),
f},AutoRouterEdgeList.prototype._blockGetG=function(d,b,s){var g=d/(b+s),S=CONSTANTS.EDLS_S,R=CONSTANTS.EDLS_R,D=CONSTANTS.EDLS_D;return g>S&&b>0&&(g=((R-S)*d+S*(D-R)*b)/((D-S)*b+(R-S)*s)),g},AutoRouterEdgeList.prototype._blockPushBackward=function(blocked,blocker){var modified=!1;assert(null!==blocked&&null!==blocker,"AREdgeList._blockPushBackward: blocked !== null && blocker !== null FAILED"),assert(blocked.positionY<=blocker.positionY,"AREdgeList._blockPushBackward: blocked.positionY <= blocker.positionY FAILED"),assert(null!==blocked.getBlockPrev(),"AREdgeList._blockPushBackward: blocked.getBlockPrev() !== null FAILED");var f=0,g=0,edge=blocked,trace=blocker,d=trace.positionY-edge.positionY;assert(d>=0,"AREdgeList._blockPushBackward: d >= 0 FAILED");for(var d2,s=edge.bracketOpening||trace.bracketClosing,b=1-s;edge.setBlockTrace(trace),trace=edge,edge=edge.getBlockPrev(),null!==edge;){if(d2=trace.positionY-edge.positionY,assert(d2>=0,"AREdgeList._blockPushBackward:  d2 >= 0 FAILED"),edge.bracketOpening||trace.bracketClosing){if(g=this._blockGetG(d,b,s),g>=d2){f=this._blockGetF(d,b,s);break}s++}else{if(f=this._blockGetF(d,b,s),f>=d2){g=this._blockGetG(d,b,s);break}b++}d+=d2}if(b+s>1){null===edge&&(f=this._blockGetF(d,b,s),g=this._blockGetG(d,b,s)),assert(Utils.floatEquals(d,f*b+g*s),"AREdgeList._blockPushBackward: floatEquals(d, f*b + g*s) FAILED"),edge=trace,assert(null!==edge&&edge!==blocked,"AREdgeList._blockPushBackward: edge !== null && edge !== blocked FAILED");var y=edge.positionY;do assert(null!==edge&&null!==edge.getBlockTrace(),"AREdgeList._blockPushBackward: edge !== null && edge.getBlockTrace() !== null FAILED"),trace=edge.getBlockTrace(),y+=edge.bracketOpening||trace.bracketClosing?g:f,y=Utils.roundTrunc(y,10),y+.001<trace.positionY&&(modified=!0,this._slideButNotPassEdges(trace,y)&&trace.setBlockPrev(null)),edge=trace;while(edge!==blocked);CONSTANTS.DEBUG&&assert(Utils.floatEquals(y,blocker.positionY),"AREdgeList._blockPushBackward: floatEquals(y, blocker.positionY) FAILED")}return modified},AutoRouterEdgeList.prototype._blockPushForward=function(blocked,blocker){var modified=!1;assert(null!==blocked&&null!==blocker,"AREdgeList._blockPushForward: blocked !== null && blocker !== null FAILED"),assert(blocked.positionY>=blocker.positionY,"AREdgeList._blockPushForward: blocked.positionY >= blocker.positionY FAILED"),assert(null!==blocked.getBlockNext(),"AREdgeList._blockPushForward: blocked.getBlockNext() !== null FAILED");var f=0,g=0,edge=blocked,trace=blocker,d=edge.positionY-trace.positionY;assert(d>=0,"AREdgeList._blockPushForward:  d >= 0 FAILED");for(var d2,s=trace.bracketOpening||edge.bracketClosing,b=1-s;edge.setBlockTrace(trace),trace=edge,edge=edge.getBlockNext(),null!==edge;){if(d2=edge.positionY-trace.positionY,assert(d2>=0,"AREdgeList._blockPushForward: d2 >= 0 FAILED"),trace.bracketOpening||edge.bracketClosing){if(g=this._blockGetG(d,b,s),g>=d2){f=this._blockGetF(d,b,s);break}s++}else{if(f=this._blockGetF(d,b,s),f>=d2){g=this._blockGetG(d,b,s);break}b++}d+=d2}if(b+s>1){null===edge&&(f=this._blockGetF(d,b,s),g=this._blockGetG(d,b,s)),assert(Utils.floatEquals(d,f*b+g*s),"AREdgeList._blockPushForward: floatEquals(d, f*b + g*s) FAILED"),edge=trace,assert(null!==edge&&!edge.equals(blocked),"AREdgeList._blockPushForward: edge != null && !edge.equals(blocked) FAILED");var y=edge.positionY;do assert(null!==edge&&null!==edge.getBlockTrace(),"AREdgeList._blockPushForward: edge !== null && edge.getBlockTrace() !== null FAILED"),trace=edge.getBlockTrace(),y-=trace.bracketOpening||edge.bracketClosing?g:f,trace.positionY<y-.001&&(modified=!0,this._slideButNotPassEdges(trace,y)&&trace.setBlockNext(null)),edge=trace;while(edge!==blocked)}return modified},AutoRouterEdgeList.prototype.blockScanForward=function(){this._positionAllLoadX();var modified=!1;this.sectionReset();for(var blocked,bmin,smin,bMinF,sMinF,blocker=this.orderFirst;blocker;){for(bmin=null,smin=null,bMinF=CONSTANTS.ED_MINCOORD-1,sMinF=CONSTANTS.ED_MINCOORD-1,this._sectionBeginScan(blocker);this._sectionHasBlockedEdge();)this._sectionIsImmediate()&&(blocked=this._sectionGetBlockedEdge(),assert(null!==blocked,"AREdgeList._blockPushForward: blocked !== null FAILED"),null!==blocked.getBlockPrev()&&(modified=this._blockPushBackward(blocked,blocker)||modified),blocker.edgeFixed||(blocked.bracketOpening||blocker.bracketClosing?sMinF<blocked.positionY&&(sMinF=blocked.positionY,smin=blocked):bMinF<blocked.positionY&&(bMinF=blocked.positionY,bmin=blocked)));bmin?smin?(blocker.setClosestPrev(sMinF>bMinF?smin:bmin),bMinF=blocker.positionY-bMinF,sMinF=this._blockGetF(blocker.positionY-sMinF,0,1),blocker.setBlockPrev(bMinF>sMinF?smin:bmin)):(blocker.setBlockPrev(bmin),blocker.setClosestPrev(bmin)):(blocker.setBlockPrev(smin),blocker.setClosestPrev(smin)),blocker=blocker.orderNext}return this._positionAllStoreY(),modified},AutoRouterEdgeList.prototype.blockScanBackward=function(){this._positionAllLoadX();var modified=!1;this.sectionReset();for(var blocked,bmin,smin,bMinF,sMinF,blocker=this.orderLast;blocker;){for(bmin=null,smin=null,bMinF=CONSTANTS.ED_MAXCOORD+1,sMinF=CONSTANTS.ED_MAXCOORD+1,this._sectionBeginScan(blocker);this._sectionHasBlockedEdge();)this._sectionIsImmediate()&&(blocked=this._sectionGetBlockedEdge(),assert(null!==blocked,"AREdgeList.blockScanBackward: blocked !== null FAILED"),null!==blocked.getBlockNext()&&(modified=this._blockPushForward(blocked,blocker)||modified),blocker.edgeFixed||(blocker.bracketOpening||blocked.bracketClosing?sMinF>blocked.positionY&&(sMinF=blocked.positionY,smin=blocked):bMinF>blocked.positionY&&(bMinF=blocked.positionY,bmin=blocked)));bmin?smin?(blocker.setClosestNext(bMinF>sMinF?smin:bmin),bMinF-=blocker.positionY,sMinF=this._blockGetF(sMinF-blocker.positionY,0,1),blocker.setBlockNext(bMinF>sMinF?smin:bmin)):(blocker.setBlockNext(bmin),blocker.setClosestNext(bmin)):(blocker.setBlockNext(smin),blocker.setClosestNext(smin)),blocker=blocker.orderPrev}return this._positionAllStoreY(),modified},AutoRouterEdgeList.prototype.blockSwitchWrongs=function(){var was=!1;this._positionAllLoadX();for(var edge,next,ey,ny,a,second=this.orderFirst;null!==second;){if(null!==second.getClosestPrev()&&second.getClosestPrev().getClosestNext()!==second&&null!==second.getClosestNext()&&second.getClosestNext().getClosestPrev()===second)for(assert(!second.edgeFixed,"AREdgeList.blockSwitchWrongs: !second.edgeFixed FAILED"),edge=second,next=edge.getClosestNext();null!==next&&edge===next.getClosestPrev();)if(assert(null!==edge&&!edge.edgeFixed,"AREdgeList.blockSwitchWrongs: edge != null && !edge.edgeFixed FAILED"),assert(null!==next&&!next.edgeFixed,"AREdgeList.blockSwitchWrongs: next != null && !next.edgeFixed FAILED"),ey=edge.positionY,ny=next.positionY,assert(ny>=ey,"AREdgeList.blockSwitchWrongs: ey <= ny FAILED"),ny>=ey+1&&this._bracketShouldBeSwitched(edge,next)){if(was=!0,assert(!edge.getEdgeCanpassed()&&!next.getEdgeCanpassed(),"AREdgeList.blockSwitchWrongs: !edge.getEdgeCanpassed() && !next.getEdgeCanpassed() FAILED"),edge.setEdgeCanpassed(!0),next.setEdgeCanpassed(!0),a=null!==this._slideButNotPassEdges(edge,(ny+ey)/2+.001),a=null!==this._slideButNotPassEdges(next,(ny+ey)/2-.001)||a){edge.setClosestPrev(null),edge.setClosestNext(null),next.setClosestPrev(null),next.setClosestNext(null),edge.setEdgeCanpassed(!1),next.setEdgeCanpassed(!1);break}null!==edge.getClosestPrev()&&edge.getClosestPrev().getClosestNext()===edge&&edge.getClosestPrev().setClosestNext(next),null!==next.getClosestNext()&&next.getClosestNext().getClosestPrev()===next&&next.getClosestNext().setClosestPrev(edge),edge.setClosestNext(next.getClosestNext()),next.setClosestNext(edge),next.setClosestPrev(edge.getClosestPrev()),edge.setClosestPrev(next),edge.setEdgeCanpassed(!1),next.setEdgeCanpassed(!1),assert(!this._bracketShouldBeSwitched(next,edge),"AREdgeList.blockSwitchWrongs: !bracketShouldBeSwitched(next, edge) FAILED"),null!==next.getClosestPrev()&&next.getClosestPrev().getClosestNext()===next?edge=next.getClosestPrev():next=edge.getClosestNext()}else edge=next,next=next.getClosestNext();second=second.orderNext}return was&&this._positionAllStoreY(),was},AutoRouterEdgeList.prototype.assertValid=function(){for(var edge=this.orderFirst;edge;)assert(void 0!==edge.startpoint.x,"Edge has unrecognized startpoint: "+edge.startpoint),assert(void 0!==edge.endpoint.x,"Edge has unrecognized endpoint: "+edge.endpoint),edge=edge.orderNext},module.exports=AutoRouterEdgeList},{"./AutoRouter.Box":10,"./AutoRouter.Constants":11,"./AutoRouter.Edge":12,"./AutoRouter.Logger":15,"./AutoRouter.Path":16,"./AutoRouter.Port":19,"./AutoRouter.Utils":22,assert:1}],14:[function(require,module,exports){"use strict";var Logger=require("./AutoRouter.Logger"),assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),ArPoint=require("./AutoRouter.Point"),ArPointListPath=require("./AutoRouter.PointList"),ArRect=require("./AutoRouter.Rect"),AutoRouterPath=require("./AutoRouter.Path"),AutoRouterPort=require("./AutoRouter.Port"),AutoRouterBox=require("./AutoRouter.Box"),AutoRouterEdgeList=(require("./AutoRouter.Edge"),require("./AutoRouter.EdgeList")),_logger=new Logger("AutoRouter.Graph"),COUNTER=1,AutoRouterGraph=function(){this.completelyConnected=!0,this.horizontal=new AutoRouterEdgeList(!0),this.vertical=new AutoRouterEdgeList(!1),this.boxes={},this.paths=[],this.bufferBoxes=[],this.box2bufferBox={},this.horizontal.owner=this,this.vertical.owner=this,this.selfPoints=[new ArPoint(CONSTANTS.ED_MINCOORD,CONSTANTS.ED_MINCOORD),new ArPoint(CONSTANTS.ED_MAXCOORD,CONSTANTS.ED_MINCOORD),new ArPoint(CONSTANTS.ED_MAXCOORD,CONSTANTS.ED_MAXCOORD),new ArPoint(CONSTANTS.ED_MINCOORD,CONSTANTS.ED_MAXCOORD)],this._addSelfEdges()};AutoRouterGraph.prototype._deleteAllBoxes=function(){for(var ids=Object.keys(this.boxes),i=ids.length;i--;)this.boxes[ids[i]].destroy(),delete this.boxes[ids[i]];this.bufferBoxes=[],this.box2bufferBox={}},AutoRouterGraph.prototype._getBoxAt=function(point,nearness){for(var ids=Object.keys(this.boxes),i=ids.length;i--;)if(this.boxes[ids[i]].isBoxAt(point,nearness))return this.boxes[ids[i]];return null},AutoRouterGraph.prototype._setPortAttr=function(port,attr){this._disconnectPathsFrom(port),port.attributes=attr},AutoRouterGraph.prototype._isRectClipBoxes=function(rect){for(var boxRect,ids=Object.keys(this.boxes),i=ids.length;i--;)if(boxRect=this.boxes[ids[i]].rect,Utils.isRectClip(rect,boxRect))return!0;return!1},AutoRouterGraph.prototype._isRectClipBufferBoxes=function(rect){for(var c,i=this.bufferBoxes.length;i--;)for(c=this.bufferBoxes[i].children.length;c--;)if(Utils.isRectClip(rect,this.bufferBoxes[i].children[c]))return!0;return!1},AutoRouterGraph.prototype._isLineClipBufferBoxes=function(p1,p2){var rect=new ArRect(p1,p2);return rect.normalizeRect(),assert(rect.left===rect.right||rect.ceil===rect.floor,"ARGraph.this._isLineClipBoxes: rect.left === rect.right || rect.ceil === rect.floor FAILED"),rect.left===rect.right&&rect.right++,rect.ceil===rect.floor&&rect.floor++,this._isRectClipBufferBoxes(rect)},AutoRouterGraph.prototype._isLineClipBoxes=function(p1,p2){var rect=new ArRect(p1,p2);return rect.normalizeRect(),assert(rect.left===rect.right||rect.ceil===rect.floor,"ARGraph.isLineClipBoxes: rect.left === rect.right || rect.ceil === rect.floor FAILED"),rect.left===rect.right&&rect.right++,rect.ceil===rect.floor&&rect.floor++,this._isRectClipBoxes(rect)},AutoRouterGraph.prototype._canBoxAt=function(rect){return!this._isRectClipBoxes.inflatedRect(rect,1)},AutoRouterGraph.prototype._add=function(path){assert(null!==path,"ARGraph.add: path !== null FAILED"),assert(!path.hasOwner(),"ARGraph.add: !path.hasOwner() FAILED"),path.owner=this,this.paths.push(path),this.horizontal.addPathEdges(path),this.vertical.addPathEdges(path),CONSTANTS.DEBUG&&this._assertValidPath(path)},AutoRouterGraph.prototype._deleteAllPaths=function(){for(var i=this.paths.length;i--;)this.paths[i].destroy();this.paths=[]},AutoRouterGraph.prototype._hasNoPath=function(){return 0===this.paths.length},AutoRouterGraph.prototype._getPathCount=function(){return this.paths.length},AutoRouterGraph.prototype._getListEdgeAt=function(point,nearness){var edge=this.horizontal.getEdgeAt(point,nearness);return edge?edge:this.vertical.getEdgeAt(point,nearness)},AutoRouterGraph.prototype._getSurroundRect=function(){var i,rect=new ArRect(0,0,0,0),ids=Object.keys(this.boxes);for(i=ids.length;i--;)rect.unionAssign(this.boxes[ids[i]].rect);for(i=this.paths.length;i--;)rect.unionAssign(this.paths[i].getSurroundRect());return rect},AutoRouterGraph.prototype._getOutOfBox=function(details){var bufferObject=this.box2bufferBox[details.box.id],children=bufferObject.children,i=bufferObject.children.length,point=details.point,dir=details.dir,boxRect=new ArRect(details.box.rect);for(boxRect.inflateRect(CONSTANTS.BUFFER),assert(Utils.isRightAngle(dir),"ARGraph.getOutOfBox: Utils.isRightAngle (dir) FAILED");boxRect.ptInRect(point);){for(Utils.isHorizontal(dir)?point.x=Utils.getRectOuterCoord(boxRect,dir):point.y=Utils.getRectOuterCoord(boxRect,dir);i--;)if(children[i].ptInRect(point)){boxRect=children[i];break}i=bufferObject.children.length}assert(!boxRect.ptInRect(point),"ARGraph.getOutOfBox: !boxRect.ptInRect( point) FAILED")},AutoRouterGraph.prototype._goToNextBufferBox=function(args){var point=args.point,end=args.end,dir=args.dir,dir2=void 0!==args.dir2&&Utils.isRightAngle(args.dir2)?args.dir2:end instanceof ArPoint?Utils.exGetMajorDir(end.minus(point)):CONSTANTS.DirNone,stophere=void 0!==args.end?args.end:1===dir||2===dir?CONSTANTS.ED_MAXCOORD:CONSTANTS.ED_MINCOORD;dir2===dir&&(dir2=Utils.isRightAngle(Utils.exGetMinorDir(end.minus(point)))?Utils.exGetMinorDir(end.minus(point)):(dir+1)%4),end instanceof ArPoint&&(stophere=Utils.getPointCoord(stophere,dir)),assert(Utils.isRightAngle(dir),"ArGraph.goToNextBufferBox: Utils.isRightAngle (dir) FAILED"),assert(Utils.getPointCoord(point,dir)!==stophere,"ArGraph.goToNextBufferBox: Utils.getPointCoord (point, dir) !== stophere FAILED");for(var boxRect,boxby=null,i=-1;++i<this.bufferBoxes.length;)boxRect=this.bufferBoxes[i].box,!Utils.isPointInDirFrom(point,boxRect,dir)&&Utils.isPointBetweenSides(point,boxRect,dir)&&Utils.isCoordInDirFrom(stophere,Utils.getChildRectOuterCoordFrom(this.bufferBoxes[i],dir,point).coord,dir)&&(stophere=Utils.getChildRectOuterCoordFrom(this.bufferBoxes[i],dir,point).coord,boxby=this.bufferBoxes[i]);return Utils.isHorizontal(dir)?point.x=stophere:point.y=stophere,boxby},AutoRouterGraph.prototype._hugChildren=function(bufferObject,point,dir1,dir2,exitCondition){assert((dir1+dir2)%2===1,"ARGraph.hugChildren: One and only one direction must be horizontal");var finalPoint,nextChild,old,children=bufferObject.children,parentBox=bufferObject.box,initPoint=new ArPoint(point),child=this._goToNextBox(point,dir1,1===dir1||2===dir1?CONSTANTS.ED_MAXCOORD:CONSTANTS.ED_MINCOORD,children),dir=dir2,nextDir=Utils.nextClockwiseDir(dir1)===dir2?Utils.nextClockwiseDir:Utils.prevClockwiseDir,points=[new ArPoint(point)],hasExit=!0;for(assert(null!==child,"ARGraph.hugChildren: child !== null FAILED"),exitCondition=void 0===exitCondition?function(pt){return!parentBox.ptInRect(pt)}:exitCondition,_logger.info("About to hug child boxes to find a path");hasExit&&!exitCondition(point,bufferObject);)old=new ArPoint(point),nextChild=this._goToNextBox(point,dir,Utils.getRectOuterCoord(child,dir),children),points[points.length-1].equals(old)||points.push(new ArPoint(old)),null===nextChild?dir=Utils.reverseDir(nextDir(dir)):Utils.isCoordInDirFrom(Utils.getRectOuterCoord(nextChild,Utils.reverseDir(nextDir(dir))),Utils.getPointCoord(point,Utils.reverseDir(nextDir(dir))),Utils.reverseDir(nextDir(dir)))&&(dir=nextDir(dir),child=nextChild),void 0===finalPoint?finalPoint=new ArPoint(point):finalPoint.equals(old)||(hasExit=!point.equals(finalPoint));return points[0].equals(initPoint)&&points.splice(0,1),hasExit||(points=null,point.assign(initPoint)),points},AutoRouterGraph.prototype._goToNextBox=function(point,dir,stop1,boxList){var stophere=stop1;stop1 instanceof ArPoint&&(stophere=Utils.getPointCoord(stophere,dir)),assert(Utils.isRightAngle(dir),"ArGraph.goToNextBox: Utils.isRightAngle (dir) FAILED"),assert(Utils.getPointCoord(point,dir)!==stophere,"ArGraph.goToNextBox: Utils.getPointCoord (point, dir) !== stophere FAILED");for(var boxRect,boxby=null,iter=boxList.length;iter--;)boxRect=boxList[iter],Utils.isPointInDirFrom(point,boxRect,Utils.reverseDir(dir))&&Utils.isPointBetweenSides(point,boxRect,dir)&&Utils.isCoordInDirFrom(stophere,Utils.getRectOuterCoord(boxRect,Utils.reverseDir(dir)),dir)&&(stophere=Utils.getRectOuterCoord(boxRect,Utils.reverseDir(dir)),boxby=boxList[iter]);return Utils.isHorizontal(dir)?point.x=stophere:point.y=stophere,boxby},AutoRouterGraph.prototype._getLimitsOfEdge=function(startPt,endPt,min,max){var t,i,rect,start=new ArPoint(startPt),end=new ArPoint(endPt),ids=Object.keys(this.boxes);if(start.y===end.y)for(start.x>end.x&&(t=start.x,start.x=end.x,end.x=t),i=ids.length;i--;)rect=this.boxes[ids[i]].rect,start.x<rect.right&&rect.left<=end.x&&(rect.floor<=start.y&&rect.floor>min&&(min=rect.floor),rect.ceil>start.y&&rect.ceil<max&&(max=rect.ceil));else for(assert(start.x===end.x,"ARGraph.this.getLimitsOfEdge: start.x === end.x FAILED"),start.y>end.y&&(t=start.y,start.y=end.y,end.y=t),i=ids.length;i--;)rect=this.boxes[ids[i]].rect,start.y<rect.floor&&rect.ceil<=end.y&&(rect.right<=start.x&&rect.right>min&&(min=rect.right),rect.left>start.x&&rect.left<max&&(max=rect.left));return max--,{min:min,max:max}},AutoRouterGraph.prototype._connect=function(path){var startport=path.getStartPort(),endport=path.getEndPort(),startpoint=path.startpoint,endpoint=path.endpoint;assert(startport.hasPoint(startpoint),"ARGraph.connect: startport.hasPoint(startpoint) FAILED"),assert(endport.hasPoint(endpoint),"ARGraph.connect: endport.hasPoint(endpoint) FAILED");var startRoot=startport.owner.getRootBox(),endRoot=endport.owner.getRootBox(),startId=startRoot.id,endId=endRoot.id,startdir=startport.portOnWhichEdge(startpoint),enddir=endport.portOnWhichEdge(endpoint);return startpoint.equals(endpoint)&&Utils.stepOneInDir(startpoint,Utils.nextClockwiseDir(startdir)),path.isAutoRouted()?this.box2bufferBox[startId]===this.box2bufferBox[endId]&&startdir===Utils.reverseDir(enddir)&&startRoot!==endRoot?this._connectPointsSharingParentBox(path,startpoint,endpoint,startdir):this._connectPathWithPoints(path,startpoint,endpoint):(path.createCustomPath(),this.horizontal.addPathEdges(path)&&this.vertical.addPathEdges(path))},AutoRouterGraph.prototype._connectPathWithPoints=function(path,startpoint,endpoint){assert(startpoint instanceof ArPoint,"ARGraph.connect: startpoint instanceof ArPoint FAILED"),assert(null!==path&&path.owner===this,"ARGraph.connect: path !== null && path.owner === self FAILED"),assert(!path.isConnected(),"ARGraph.connect: !path.isConnected() FAILED"),assert(!startpoint.equals(endpoint),"ARGraph.connect: !startpoint.equals(endpoint) FAILED");var startPort=path.getStartPort();assert(null!==startPort,"ARGraph.connect: startPort !== null FAILED");var startdir=startPort.portOnWhichEdge(startpoint),endPort=path.getEndPort();assert(null!==endPort,"ARGraph.connect: endPort !== null FAILED");var enddir=endPort.portOnWhichEdge(endpoint);assert(Utils.isRightAngle(startdir)&&Utils.isRightAngle(enddir),"ARGraph.connect: Utils.isRightAngle (startdir) && Utils.isRightAngle (enddir) FAILED");var start=new ArPoint(startpoint);this._getOutOfBox({point:start,dir:startdir,end:endpoint,box:startPort.owner}),assert(!start.equals(startpoint),"ARGraph.connect: !start.equals(startpoint) FAILED");var end=new ArPoint(endpoint);this._getOutOfBox({point:end,dir:enddir,end:start,box:endPort.owner}),assert(!end.equals(endpoint),"ARGraph.connect: !end.equals(endpoint) FAILED");var points,isAutoRouted=path.isAutoRouted();return isAutoRouted&&(points=this._connectPoints(start,end,startdir,enddir)),path.points=points,path.points.unshift(startpoint),path.points.push(endpoint),isAutoRouted&&(this._simplifyPathCurves(path),path.simplifyTrivially(),this._simplifyPathPoints(path),this._centerStairsInPathPoints(path,startdir,enddir)),path.setState(CONSTANTS.PathStateConnected),this.horizontal.addPathEdges(path)&&this.vertical.addPathEdges(path)},AutoRouterGraph.prototype._connectPointsSharingParentBox=function(path,startpoint,endpoint,startdir){var start=new ArPoint(startpoint),dx=endpoint.x-start.x,dy=endpoint.y-start.y;return path.deleteAll(),path.addTail(startpoint),0!==dx&&0!==dy&&(Utils.isHorizontal(startdir)?(start.x+=dx/2,path.addTail(new ArPoint(start)),start.y+=dy,path.addTail(new ArPoint(start))):(start.y+=dy/2,path.addTail(new ArPoint(start)),start.x+=dx,path.addTail(new ArPoint(start)))),path.addTail(endpoint),path.setState(CONSTANTS.PathStateConnected),this.horizontal.addPathEdges(path)&&this.vertical.addPathEdges(path)},AutoRouterGraph.prototype._connectPoints=function(start,end,hintstartdir,hintenddir,flipped){for(var bufferObject,box,rect,dir1,dir2,old,oldEnd,ret2,pts,rev,i,ret=new ArPointListPath,thestart=new ArPoint(start),findExitToEndpoint=function(pt,bo){return(pt.x===end.x||pt.y===end.y)&&!Utils.isLineClipRects(pt,end,bo.children)},getToDir1Side=function(pt,bo){return Utils.getPointCoord(pt,dir1)===Utils.getRectOuterCoord(bo.box,dir1)||Utils.isPointInDirFrom(pt,end,dir1)};!start.equals(end);)if(dir1=Utils.exGetMajorDir(end.minus(start)),dir2=Utils.exGetMinorDir(end.minus(start)),assert(dir1!==CONSTANTS.DirNone,"ARGraph.connectPoints: dir1 !== CONSTANTS.DirNone FAILED"),assert(dir1===Utils.getMajorDir(end.minus(start)),"ARGraph.connectPoints: dir1 === Utils.getMajorDir(end.minus(start)) FAILED"),assert(dir2===CONSTANTS.DirNone||dir2===Utils.getMinorDir(end.minus(start)),"ARGraph.connectPoints: dir2 === CONSTANTS.DirNone || dir2 === Utils.getMinorDir(end.minus(start)) FAILED"),dir2===hintstartdir&&dir2!==CONSTANTS.DirNone&&(dir2=dir1,dir1=hintstartdir),ret.push(new ArPoint(start)),old=new ArPoint(start),bufferObject=this._goToNextBufferBox({point:start,dir:dir1,dir2:dir2,end:end}),box=null===bufferObject?null:bufferObject.box,start.equals(old)){if(assert(null!==box,"ARGraph.connectPoints: box !== null FAILED"),rect=box instanceof ArRect?box:box.rect,dir2===CONSTANTS.DirNone&&(dir2=Utils.nextClockwiseDir(dir1)),assert(dir1!==dir2&&dir1!==CONSTANTS.DirNone&&dir2!==CONSTANTS.DirNone,"ARGraph.connectPoints: dir1 !== dir2 && dir1 !== CONSTANTS.DirNone && dir2 !== CONSTANTS.DirNone FAILED"),bufferObject.box.ptInRect(end)&&!bufferObject.box.ptInRect(start)&&flipped)Utils.isHorizontal(dir1)?start.x=end.x:start.y=end.y;else if(bufferObject.box.ptInRect(end))if(flipped)pts=this._hugChildren(bufferObject,start,dir1,dir2,findExitToEndpoint),null!==pts?(pts.length&&(ret=ret.concat(pts)),ret.push(new ArPoint(start)),start.assign(end)):(assert(Utils.isRightAngle(dir1),"ARGraph.connectPoints: Utils.isRightAngle (dir1) FAILED"),Utils.isHorizontal(dir1)?start.x=end.x:start.y=end.y,ret.push(new ArPoint(start)),Utils.isHorizontal(dir1)?start.y=end.y:start.x=end.x,ret.push(new ArPoint(start)),assert(start.equals(end))),assert(!start.equals(old));else{for(_logger.info("Could not find path from",start,"to",end,". Flipping start and end points"),oldEnd=new ArPoint(end),ret2=this._connectPoints(end,start,hintenddir,dir1,!0),i=ret2.length-1;i-- >1;)ret.push(ret2[i]);assert(start.equals(end),"ArGraph.connectPoints: start.equals(end) FAILED"),old=CONSTANTS.EMPTY_POINT,start=end=oldEnd}else Utils.isPointInDirFrom(end,rect,dir2)?(assert(!Utils.isPointInDirFrom(start,rect,dir2),"ARGraph.connectPoints: !Utils.isPointInDirFrom(start, rect, dir2) FAILED"),box=this._goToNextBufferBox({point:start,dir:dir2,dir2:dir1,end:end}),start.equals(old)&&(pts=box.children.length>1?this._hugChildren(box,start,dir2,dir1,getToDir1Side):this._hugChildren(bufferObject,start,dir1,dir2),null!==pts?ret=ret.concat(pts):(assert(Utils.isRightAngle(dir1),"ARGraph.getOutOfBox: Utils.isRightAngle (dir1) FAILED"),Utils.isHorizontal(dir1)?start.x=Utils.getRectOuterCoord(bufferObject.box,dir1):start.y=Utils.getRectOuterCoord(bufferObject.box,dir1)))):(assert(Utils.isPointBetweenSides(end,rect,dir1),"ARGraph.connectPoints: Utils.isPointBetweenSides(end, rect, dir1) FAILED"),assert(!Utils.isPointIn(end,rect),"ARGraph.connectPoints: !Utils.isPointIn(end, rect) FAILED"),rev=0,Utils.reverseDir(dir2)===hintenddir&&Utils.getChildRectOuterCoordFrom(bufferObject,Utils.reverseDir(dir2),start)===Utils.getRectOuterCoord(rect,Utils.reverseDir(dir2))?rev=1:dir2!==hintenddir&&(Utils.isPointBetweenSides(thestart,rect,dir1)?Utils.isPointInDirFrom(rect.getTopLeft().plus(rect.getBottomRight()),start.plus(end),dir2)&&(rev=1):Utils.isPointInDirFrom(start,thestart,dir2)&&(rev=1)),rev&&(dir2=Utils.reverseDir(dir2)),1===bufferObject.children.length?(Utils.isHorizontal(dir2)?start.x=Utils.getRectOuterCoord(rect,dir2):start.y=Utils.getRectOuterCoord(rect,dir2),assert(!start.equals(old),"ARGraph.connectPoints: !start.equals(old) FAILED"),ret.push(new ArPoint(start)),old.assign(start),Utils.isHorizontal(dir1)?start.x=Utils.getRectOuterCoord(rect,dir1):start.y=Utils.getRectOuterCoord(rect,dir1),assert(Utils.isPointInDirFrom(end,start,dir1),"ARGraph.connectPoints: Utils.isPointInDirFrom(end, start, dir1) FAILED"),Utils.getPointCoord(start,dir1)!==Utils.getPointCoord(end,dir1)&&this._goToNextBufferBox({point:start,dir:dir1,end:end})):(pts=this._hugChildren(bufferObject,start,dir1,dir2,getToDir1Side),null!==pts?ret=ret.concat(pts):(assert(Utils.isRightAngle(dir1),"ARGraph.getOutOfBox: Utils.isRightAngle (dir1) FAILED"),Utils.isHorizontal(dir1)?start.x=Utils.getRectOuterCoord(bufferObject.box,dir1):start.y=Utils.getRectOuterCoord(bufferObject.box,dir1))));assert(!start.equals(old),"ARGraph.connectPoints: !start.equals(old) FAILED")}return ret.push(end),CONSTANTS.DEBUG&&ret.assertValid(),ret},AutoRouterGraph.prototype._disconnectAll=function(){for(var i=this.paths.length;i--;)this.disconnect(this.paths[i])},AutoRouterGraph.prototype.disconnect=function(path){path.isConnected()&&this.deleteEdges(path),path.deleteAll(),this.completelyConnected=!1},AutoRouterGraph.prototype._disconnectPathsClipping=function(rect){for(var i=this.paths.length;i--;)this.paths[i].isPathClip(rect)&&this.disconnect(this.paths[i])},AutoRouterGraph.prototype._disconnectPathsFrom=function(obj){var path,startport,endport,iter=this.paths.length;if(obj instanceof AutoRouterBox)for(var startbox,endbox,box=obj;iter--;)path=this.paths[iter],assert(null!==path.startports,"ARGraph.disconnectPathsFrom: startport !== null FAILED"),assert(path.startports.length>0,"ARGraph.disconnectPathsFrom: Path has no startports"),assert(null!==path.endports,"ARGraph.disconnectPathsFrom: endport !== null FAILED"),assert(path.endports.length>0,"ARGraph.disconnectPathsFrom: Path has no endports"),startbox=path.startports[0].owner,endbox=path.endports[0].owner,assert(null!==startbox,"ARGraph.disconnectPathsFrom: startbox !== null FAILED"),assert(null!==endbox,"ARGraph.disconnectPathsFrom: endbox !== null FAILED"),(startbox===box||endbox===box)&&this.disconnect(path);else for(var port=obj;iter--;)path=this.paths[iter],startport=path.getStartPort(),endport=path.getEndPort(),(startport===port||endport===port)&&this.disconnect(path)},AutoRouterGraph.prototype._addSelfEdges=function(){this.horizontal.addEdges(this),this.vertical.addEdges(this)},AutoRouterGraph.prototype._addEdges=function(obj){assert(!(obj instanceof AutoRouterPath),"No Paths should be here!"),obj instanceof AutoRouterPort?(this.horizontal.addPortEdges(obj),this.vertical.addPortEdges(obj)):(this.horizontal.addEdges(obj),this.vertical.addEdges(obj))},AutoRouterGraph.prototype.deleteEdges=function(object){this.horizontal.deleteEdges(object),this.vertical.deleteEdges(object)},AutoRouterGraph.prototype._addAllEdges=function(){assert(this.horizontal.isEmpty()&&this.vertical.isEmpty(),"ARGraph.addAllEdges: horizontal.isEmpty() && vertical.isEmpty() FAILED");var i,ids=Object.keys(this.boxes);for(i=ids.length;i--;)this._addBoxAndPortEdges(this.boxes[ids[i]]);for(i=this.paths.length;i--;)this.horizontal.addPathEdges(this.paths[i]),this.vertical.addPathEdges(this.paths[i])},AutoRouterGraph.prototype._deleteAllEdges=function(){this.horizontal.deleteAllEdges(),this.vertical.deleteAllEdges()},AutoRouterGraph.prototype._addBoxAndPortEdges=function(box){assert(null!==box,"ARGraph.addBoxAndPortEdges: box !== null FAILED"),this._addEdges(box);for(var i=box.ports.length;i--;)this._addEdges(box.ports[i]);this._addToBufferBoxes(box),this._updateBoxPortAvailability(box)},AutoRouterGraph.prototype._deleteBoxAndPortEdges=function(box){assert(null!==box,"ARGraph.deleteBoxAndPortEdges: box !== null FAILED"),this.deleteEdges(box);for(var i=box.ports.length;i--;)this.deleteEdges(box.ports[i]);this._removeFromBufferBoxes(box)},AutoRouterGraph.prototype._getEdgeList=function(ishorizontal){return ishorizontal?this.horizontal:this.vertical},AutoRouterGraph.prototype._candeleteTwoEdgesAt=function(path,points,pos){if(CONSTANTS.DEBUG&&(assert(path.owner===this,"ARGraph.candeleteTwoEdgesAt: path.owner === this FAILED"),path.assertValid(),assert(path.isConnected(),"ARGraph.candeleteTwoEdgesAt: path.isConnected() FAILED"),points.AssertValidPos(pos)),pos+2>=points.length||1>pos)return!1;var pointpos=pos,point=points[pos++],npointpos=pos,npoint=points[pos++],nnpointpos=pos;pos=pointpos,pos--;var ppointpos=pos,ppoint=points[pos--],pppointpos=pos;if(npoint.equals(point))return!1;assert(pppointpos<points.length&&ppointpos<points.length&&pointpos<points.length&&npointpos<points.length&&nnpointpos<points.length,"ARGraph.candeleteTwoEdgesAt: pppointpos < points.length && ppointpos < points.length &&pointpos < points.length && npointpos < points.length && nnpointpos < points.length FAILED");var dir=Utils.getDir(npoint.minus(point));assert(Utils.isRightAngle(dir),"ARGraph.candeleteTwoEdgesAt: Utils.isRightAngle (dir) FAILED");var ishorizontal=Utils.isHorizontal(dir),newpoint=new ArPoint;return ishorizontal?(newpoint.x=Utils.getPointCoord(npoint,ishorizontal),newpoint.y=Utils.getPointCoord(ppoint,!ishorizontal)):(newpoint.y=Utils.getPointCoord(npoint,ishorizontal),newpoint.x=Utils.getPointCoord(ppoint,!ishorizontal)),assert(Utils.getDir(newpoint.minus(ppoint))===dir,"ARGraph.candeleteTwoEdgesAt: Utils.getDir (newpoint.minus(ppoint)) === dir FAILED"),this._isLineClipBoxes(newpoint,npoint)?!1:this._isLineClipBoxes(newpoint,ppoint)?!1:!0},AutoRouterGraph.prototype._deleteTwoEdgesAt=function(path,points,pos){CONSTANTS.DEBUG&&(assert(path.owner===this,"ARGraph.deleteTwoEdgesAt: path.owner === this FAILED"),path.assertValid(),assert(path.isConnected(),"ARGraph.deleteTwoEdgesAt: path.isConnected() FAILED"),points.AssertValidPos(pos));var pointpos=pos,point=points[pos++],npointpos=pos,npoint=points[pos++],nnpointpos=pos,nnpoint=points[pos++],nnnpointpos=pos;pos=pointpos,pos--;var ppointpos=pos,ppoint=points[pos--],pppointpos=pos,pppoint=points[pos--];assert(pppointpos<points.length&&ppointpos<points.length&&pointpos<points.length&&npointpos<points.length&&nnpointpos<points.length,"ARGraph.deleteTwoEdgesAt: pppointpos < points.length && ppointpos < points.length && pointpos < points.length && npointpos < points.length && nnpointpos < points.length FAILED"),assert(null!==pppoint&&null!==ppoint&&null!==point&&null!==npoint&&null!==nnpoint,"ARGraph.deleteTwoEdgesAt: pppoint !== null && ppoint !== null && point !== null && npoint !== null && nnpoint !== null FAILED");var dir=Utils.getDir(npoint.minus(point));assert(Utils.isRightAngle(dir),"ARGraph.deleteTwoEdgesAt: Utils.isRightAngle (dir) FAILED");var ishorizontal=Utils.isHorizontal(dir),newpoint=new ArPoint;ishorizontal?(newpoint.x=Utils.getPointCoord(npoint,ishorizontal),newpoint.y=Utils.getPointCoord(ppoint,!ishorizontal)):(newpoint.x=Utils.getPointCoord(ppoint,!ishorizontal),newpoint.y=Utils.getPointCoord(npoint,ishorizontal)),assert(Utils.getDir(newpoint.minus(ppoint))===dir,"ARGraph.deleteTwoEdgesAt: Utils.getDir (newpoint.minus(ppoint)) === dir FAILED"),
assert(!this._isLineClipBoxes(newpoint,npoint),"ARGraph.deleteTwoEdgesAt: !isLineClipBoxes(newpoint, npoint) FAILED"),assert(!this._isLineClipBoxes(newpoint,ppoint),"ARGraph.deleteTwoEdgesAt: !isLineClipBoxes(newpoint, ppoint) FAILED");var hlist=this._getEdgeList(ishorizontal),vlist=this._getEdgeList(!ishorizontal),ppedge=hlist.getEdgeByPointer(pppoint),pedge=vlist.getEdgeByPointer(ppoint),nedge=hlist.getEdgeByPointer(point),nnedge=vlist.getEdgeByPointer(npoint);if(assert(null!==ppedge&&null!==pedge&&null!==nedge&&null!==nnedge,"ARGraph.deleteTwoEdgesAt:  ppedge !== null && pedge !== null && nedge !== null && nnedge !== null FAILED"),vlist.remove(pedge),hlist.remove(nedge),points.splice(ppointpos,3,newpoint),ppedge.endpointNext=nnpoint,ppedge.endpoint=newpoint,nnedge.startpoint=newpoint,nnedge.startpointPrev=pppoint,nnnpointpos<points.length){var nnnedge=hlist.getEdgeByPointer(nnpoint,nnnpointpos);assert(null!==nnnedge,"ARGraph.deleteTwoEdgesAt: nnnedge !== null FAILED"),assert(nnnedge.startpointPrev.equals(npoint)&&nnnedge.startpoint.equals(nnpoint),"ARGraph.deleteTwoEdgesAt: nnnedge.startpointPrev.equals(npoint)&& nnnedge.startpoint.equals(nnpoint) FAILED"),nnnedge.startpointPrev=ppoint}nnpoint.equals(newpoint)&&this._deleteSamePointsAt(path,points,ppointpos)},AutoRouterGraph.prototype._deleteSamePointsAt=function(path,points,pos){CONSTANTS.DEBUG&&(assert(path.owner===this,"ARGraph.deleteSamePointsAt: path.owner === this FAILED"),path.assertValid(),assert(path.isConnected(),"ARGraph.deleteSamePointsAt: path.isConnected() FAILED"),points.AssertValidPos(pos));var pointpos=pos,point=points[pos++],npointpos=pos,npoint=points[pos++],nnpointpos=pos,nnpoint=points[pos++],nnnpointpos=pos;pos=pointpos,pos--;var ppointpos=pos,ppoint=points[pos--],pppointpos=pos,pppoint=pos===points.length?null:points[pos--];assert(ppointpos<points.length&&pointpos<points.length&&npointpos<points.length&&nnpointpos<points.length),assert(null!==ppoint&&null!==point&&null!==npoint&&null!==nnpoint,"ARGraph.deleteSamePointsAt: ppoint !== null && point !== null && npoint !== null && nnpoint !== null FAILED"),assert(point.equals(npoint)&&!point.equals(ppoint),"ARGraph.deleteSamePointsAt: point.equals(npoint) && !point.equals(ppoint) FAILED");var dir=Utils.getDir(point.minus(ppoint));assert(Utils.isRightAngle(dir),"ARGraph.deleteSamePointsAt: Utils.isRightAngle (dir) FAILED");var ishorizontal=Utils.isHorizontal(dir),hlist=this._getEdgeList(ishorizontal),vlist=this._getEdgeList(!ishorizontal),pedge=hlist.getEdgeByPointer(ppoint,point),nedge=vlist.getEdgeByPointer(point,npoint),nnedge=hlist.getEdgeByPointer(npoint,nnpoint);if(assert(null!==pedge&&null!==nedge&&null!==nnedge,"ARGraph.deleteSamePointsAt: pedge !== null && nedge !== null && nnedge !== null FAILED"),vlist.remove(pedge),hlist.remove(nedge),points.splice(pointpos,2),pppointpos<points.length){var ppedge=vlist.getEdgeByPointer(pppoint,ppoint);assert(null!==ppedge&&ppedge.endpoint.equals(ppoint)&&ppedge.endpointNext.equals(point),"ARGraph.deleteSamePointsAt: ppedge !== null && ppedge.endpoint.equals(ppoint) && ppedge.endpointNext.equals(point) FAILED"),ppedge.endpointNext=nnpoint}if(assert(nnedge.startpoint.equals(npoint)&&nnedge.startpointPrev.equals(point),"ARGraph.deleteSamePointsAt: nnedge.startpoint.equals(npoint) && nnedge.startpointPrev.equals(point) FAILED"),nnedge.setStartPoint(ppoint),nnedge.startpointPrev=pppoint,nnnpointpos<points.length){var nnnedge=vlist.getEdgeByPointer(nnpoint,nnnpointpos);assert(null!==nnnedge&&nnnedge.startpointPrev.equals(npoint)&&nnnedge.startpoint.equals(nnpoint),"ARGraph.deleteSamePointsAt: nnnedge !== null && nnnedge.startpointPrev.equals(npoint) && nnnedge.startpoint.equals(nnpoint) FAILED"),nnnedge.startpointPrev=ppoint}CONSTANTS.DEBUG_DEEP&&path.assertValid()},AutoRouterGraph.prototype._simplifyPaths=function(){for(var path,pointList,pointpos,modified=!1,i=this.paths.length;i--;)if(path=this.paths[i],path.isAutoRouted())for(pointList=path.getPointList(),pointpos=0,modified=this._fixShortPaths(path)||modified;pointpos<pointList.length;){if(this._candeleteTwoEdgesAt(path,pointList,pointpos)){this._deleteTwoEdgesAt(path,pointList,pointpos),modified=!0;break}pointpos++}return modified},AutoRouterGraph.prototype._centerStairsInPathPoints=function(path,hintstartdir,hintenddir){assert(null!==path,"ARGraph.centerStairsInPathPoints: path !== null FAILED"),assert(!path.isConnected(),"ARGraph.centerStairsInPathPoints: !path.isConnected() FAILED");var pointList=path.getPointList();assert(pointList.length>=2,"ARGraph.centerStairsInPathPoints: pointList.length >= 2 FAILED"),CONSTANTS.DEBUG&&path.assertValidPoints();var p1,p2,p3,p4,p1p=pointList.length,p2p=pointList.length,p3p=pointList.length,p4p=pointList.length,d12=CONSTANTS.DirNone,d23=CONSTANTS.DirNone,d34=CONSTANTS.DirNone,outOfBoxStartPoint=path.getOutOfBoxStartPoint(hintstartdir),outOfBoxEndPoint=path.getOutOfBoxEndPoint(hintenddir),pos=0;assert(pos<pointList.length,"ARGraph.centerStairsInPathPoints pos < pointList.length FAILED"),p1p=pos,p1=pointList[pos++];for(var np2,np3,h,p4x,p3x,p1x,tmp,t,m;pos<pointList.length;)p4p=p3p,p3p=p2p,p2p=p1p,p1p=pos,p4=p3,p3=p2,p2=p1,p1=pointList[pos++],d34=d23,d23=d12,p2p<pointList.length&&(d12=Utils.getDir(p2.minus(p1)),CONSTANTS.DEBUG&&(assert(Utils.isRightAngle(d12),"ARGraph.centerStairsInPathPoints: Utils.isRightAngle (d12) FAILED"),p3p!==pointList.end()&&assert(Utils.areInRightAngle(d12,d23),"ARGraph.centerStairsInPathPoints: Utils.areInRightAngle (d12, d23) FAILED"))),p4p<pointList.length&&d12===d34&&(assert(p1p<pointList.length&&p2p<pointList.length&&p3p<pointList.length&&p4p<pointList.length,"ARGraph.centerStairsInPathPoints: p1p < pointList.length && p2p < pointList.length && p3p < pointList.length && p4p < pointList.length FAILED"),np2=new ArPoint(p2),np3=new ArPoint(p3),h=Utils.isHorizontal(d12),p4x=Utils.getPointCoord(p4,h),p3x=Utils.getPointCoord(p3,h),p1x=Utils.getPointCoord(p1,h),p4x>p1x&&(t=p1x,p1x=p4x,p4x=t),p3x>p4x&&p1x>p3x&&(m=Math.round((p4x+p1x)/2),h?(np2.x=m,np3.x=m):(np2.y=m,np3.y=m),tmp=this._getLimitsOfEdge(np2,np3,p4x,p1x),p4x=tmp.min,p1x=tmp.max,m=Math.round((p4x+p1x)/2),h?(np2.x=m,np3.x=m):(np2.y=m,np3.y=m),this._isLineClipBoxes(np2,np3)||this._isLineClipBoxes(p1p===pointList.length?outOfBoxEndPoint:p1,np2)||this._isLineClipBoxes(0===p4p?outOfBoxStartPoint:p4,np3)||(p2=np2,p3=np3,pointList.splice(p2p,1,p2),pointList.splice(p3p,1,p3))));CONSTANTS.DEBUG&&path.assertValidPoints()},AutoRouterGraph.prototype._fixShortPaths=function(path){var modified=!1,startport=path.getStartPort(),endport=path.getEndPort(),len=path.getPointList().length;if(4===len){var tstStart,tstEnd,points=path.getPointList(),startpoint=points[0],endpoint=points[len-1],startDir=startport.portOnWhichEdge(startpoint),endDir=endport.portOnWhichEdge(endpoint);if(startDir===Utils.reverseDir(endDir)){var minOverlap,maxOverlap,isHorizontal=Utils.isHorizontal(startDir),newStart=new ArPoint(startpoint),newEnd=new ArPoint(endpoint),startRect=startport.rect,endRect=endport.rect;if(isHorizontal){minOverlap=Math.min(startRect.floor,endRect.floor),maxOverlap=Math.max(startRect.ceil,endRect.ceil);var newY=(minOverlap+maxOverlap)/2;newStart.y=newY,newEnd.y=newY,tstStart=new ArPoint(Utils.getRectOuterCoord(startport.owner.rect,startDir),newStart.y),tstEnd=new ArPoint(Utils.getRectOuterCoord(endport.owner.rect,endDir),newEnd.y)}else{minOverlap=Math.min(startRect.right,endRect.right),maxOverlap=Math.max(startRect.left,endRect.left);var newX=(minOverlap+maxOverlap)/2;newStart.x=newX,newEnd.x=newX,tstStart=new ArPoint(newStart.x,Utils.getRectOuterCoord(startport.owner.rect,startDir)),tstEnd=new ArPoint(newEnd.x,Utils.getRectOuterCoord(endport.owner.rect,endDir))}var validPointLocation=startRect.ptInRect(newStart)&&!startRect.onCorner(newStart)&&endRect.ptInRect(newEnd)&&!endRect.onCorner(newEnd);if(validPointLocation&&!this._isLineClipBoxes(tstStart,tstEnd)){var hlist=this._getEdgeList(isHorizontal),vlist=this._getEdgeList(!isHorizontal),edge=hlist.getEdgeByPointer(startpoint),edge2=vlist.getEdgeByPointer(points[1]),edge3=hlist.getEdgeByPointer(points[2]);vlist.remove(edge2),hlist.remove(edge3),hlist.remove(edge),startpoint.assign(newStart),endpoint.assign(newEnd),edge.setEndPoint(endpoint),edge.startpointPrev=null,edge.endpointNext=null,edge.positionY=Utils.getPointCoord(newStart,Utils.nextClockwiseDir(startDir)),hlist.insert(edge),points.splice(1,2),modified=!0}}}return modified},AutoRouterGraph.prototype._simplifyPathCurves=function(path){for(var p1,p2,j,pointList=path.getPointList(),i=0;i<pointList.length-3;){for(p1=pointList[i],j=pointList.length;j-- >0;)if(p2=pointList[j],Utils.isRightAngle(Utils.getDir(p1.minus(p2)))&&!this._isLineClipBoxes(p1,p2)||p1.equals(p2)){pointList.splice(i+1,j-i-1);break}++i}},AutoRouterGraph.prototype._simplifyPathPoints=function(path){assert(null!==path,"ARGraph.simplifyPathPoints: path !== null FAILED"),assert(!path.isConnected(),"ARGraph.simplifyPathPoints: !path.isConnected() FAILED");var pointList=path.getPointList();assert(pointList.length>=2,"ARGraph.simplifyPathPoints: pointList.length >= 2 FAILED"),CONSTANTS.DEBUG&&path.assertValidPoints();var p1,p2,p3,p4,p5,np3,d,h,p1p=pointList.length,p2p=pointList.length,p3p=pointList.length,p4p=pointList.length,p5p=pointList.length,pos=0;for(assert(pos<pointList.length,"ARGraph.simplifyPathPoints: pos < pointList.length FAILED"),p1p=pos,p1=pointList[pos++];pos<pointList.length;)p5p=p4p,p4p=p3p,p3p=p2p,p2p=p1p,p1p=pos,p5=p4,p4=p3,p3=p2,p2=p1,p1=pointList[pos++],p5p<pointList.length&&(assert(p1p<pointList.length&&p2p<pointList.length&&p3p<pointList.length&&p4p<pointList.length&&p5p<pointList.length,"ARGraph.simplifyPathPoints: p1p < pointList.length && p2p < pointList.length && p3p < pointList.length && p4p < pointList.length && p5p < pointList.length FAILED"),assert(!(p1.equals(p2)||p2.equals(p3)||p3.equals(p4)||p4.equals(p5)),"ARGraph.simplifyPathPoints: !p1.equals(p2) && !p2.equals(p3) && !p3.equals(p4) && !p4.equals(p5) FAILED"),d=Utils.getDir(p2.minus(p1)),assert(Utils.isRightAngle(d),"ARGraph.simplifyPathPoints: Utils.isRightAngle (d) FAILED"),h=Utils.isHorizontal(d),np3=new ArPoint,h?(np3.x=Utils.getPointCoord(p5,h),np3.y=Utils.getPointCoord(p1,!h)):(np3.x=Utils.getPointCoord(p1,!h),np3.y=Utils.getPointCoord(p5,h)),this._isLineClipBoxes(p2,np3)||this._isLineClipBoxes(np3,p4)||(pointList.splice(p2p,1),pointList.splice(p3p,1),pointList.splice(p4p,1),np3.equals(p1)||np3.equals(p5)||pointList.splice(p4p,0,np3),p1p=pointList.length,p2p=pointList.length,p3p=pointList.length,p4p=pointList.length,pos=0));CONSTANTS.DEBUG&&path.assertValidPoints()},AutoRouterGraph.prototype._connectAllDisconnectedPaths=function(){for(var i,path,len=this.paths.length,success=!1,giveup=!1;!success&&!giveup;){for(success=!0,i=len;i--&&success;)path=this.paths[i],path.isConnected()||(success=this._connect(path),success||(path.areTherePathCustomizations()?path.removePathCustomizations():giveup=!0));success||giveup||this._disconnectAll()}this.completelyConnected=!0},AutoRouterGraph.prototype._updateBoxPortAvailability=function(inputBox){var bufferbox,siblings,box,id,skipBoxes={};bufferbox=this.box2bufferBox[inputBox.id],assert(bufferbox,"Bufferbox not found for "+inputBox.id),siblings=bufferbox.children,box=inputBox;do skipBoxes[box.id]=!0,box=box.parent;while(box);for(var i=siblings.length;i--;)id=siblings[i].id,skipBoxes[id]||inputBox.rect.touching(siblings[i])&&(inputBox.adjustPortAvailability(this.boxes[siblings[i].id]),this.boxes[siblings[i].id].adjustPortAvailability(inputBox))},AutoRouterGraph.prototype._addToBufferBoxes=function(inputBox){var bufferBox,parentBox,child,i,j,box={rect:new ArRect(inputBox.rect),id:inputBox.id},overlapBoxesIndices=[],children=[],ids=[inputBox.id];for(box.rect.inflateRect(CONSTANTS.BUFFER),assert(!this.box2bufferBox[inputBox.id],"Can't add box to 2 bufferboxes"),i=this.bufferBoxes.length;i--;)if(box.rect.touching(this.bufferBoxes[i].box))for(j=this.bufferBoxes[i].children.length;j--;)child=this.bufferBoxes[i].children[j],box.rect.touching(child)&&(inputBox.adjustPortAvailability(this.boxes[child.id]),this.boxes[child.id].adjustPortAvailability(inputBox),-1===overlapBoxesIndices.indexOf(i)&&overlapBoxesIndices.push(i));if(parentBox=new ArRect(box.rect),0!==overlapBoxesIndices.length)for(i=0;i<overlapBoxesIndices.length;i++){for(assert(overlapBoxesIndices[i]<this.bufferBoxes.length,"ArGraph.addToBufferBoxes: overlapBoxes index out of bounds. ("+overlapBoxesIndices[i]+" < "+this.bufferBoxes.length+")"),bufferBox=this.bufferBoxes.splice(overlapBoxesIndices[i],1)[0],j=bufferBox.children.length;j--;)children.push(bufferBox.children[j]),ids.push(bufferBox.children[j].id);parentBox.unionAssign(bufferBox.box)}for(box.rect.id=inputBox.id,children.push(box.rect),this.bufferBoxes.push({box:parentBox,children:children}),i=ids.length;i--;)this.box2bufferBox[ids[i]]=this.bufferBoxes[this.bufferBoxes.length-1]},AutoRouterGraph.prototype._removeFromBufferBoxes=function(box){var parentBox,child,group,ids,id,j,g,bufferBox=this.box2bufferBox[box.id],i=this.bufferBoxes.indexOf(bufferBox),children=bufferBox.children,groups=[],add=!1;for(assert(-1!==i,"ARGraph.removeFromBufferBoxes: Can't find the correct bufferbox."),this.bufferBoxes.splice(i,1),this.box2bufferBox[box.id]=void 0,i=children.length;i--;)if(g=groups.length,child=children[i],group=[child],add=!1,this.boxes[child.id].resetPortAvailability(),child.id!==box.id){for(;g--;){for(j=groups[g].length;j--;)groups[g][j].touching(child)&&(id=groups[g][j].id,this.boxes[child.id].adjustPortAvailability(this.boxes[id]),this.boxes[id].adjustPortAvailability(this.boxes[child.id]),add=!0);add&&(group=group.concat(groups.splice(g,1)[0]))}groups.push(group)}for(i=groups.length;i--;){for(j=groups[i].length,parentBox=new ArRect(groups[i][0]),ids=[];j--;)parentBox.unionAssign(groups[i][j]),ids.push(groups[i][j].id);for(this.bufferBoxes.push({box:parentBox,children:groups[i]}),j=ids.length;j--;)this.box2bufferBox[ids[j]]=this.bufferBoxes[this.bufferBoxes.length-1]}},AutoRouterGraph.prototype.setBuffer=function(newBuffer){CONSTANTS.BUFFER=newBuffer},AutoRouterGraph.prototype.calculateSelfPoints=function(){this.selfPoints=[],this.selfPoints.push(new ArPoint(CONSTANTS.ED_MINCOORD,CONSTANTS.ED_MINCOORD)),this.selfPoints.push(new ArPoint(CONSTANTS.ED_MAXCOORD,CONSTANTS.ED_MINCOORD)),this.selfPoints.push(new ArPoint(CONSTANTS.ED_MAXCOORD,CONSTANTS.ED_MAXCOORD)),this.selfPoints.push(new ArPoint(CONSTANTS.ED_MINCOORD,CONSTANTS.ED_MAXCOORD))},AutoRouterGraph.prototype.createBox=function(){var box=new AutoRouterBox;return assert(null!==box,"ARGraph.createBox: box !== null FAILED"),box},AutoRouterGraph.prototype.addBox=function(box){assert(null!==box,"ARGraph.addBox: box !== null FAILED"),assert(box instanceof AutoRouterBox,"ARGraph.addBox: box instanceof AutoRouterBox FAILED");var rect=box.rect;this._disconnectPathsClipping(rect),box.owner=this;for(var boxId=(COUNTER++).toString();boxId.length<6;)boxId="0"+boxId;boxId="BOX_"+boxId,box.id=boxId,this.boxes[boxId]=box,this._addBoxAndPortEdges(box);for(var children=box.childBoxes,i=children.length;i--;)this.addBox(children[i])},AutoRouterGraph.prototype.deleteBox=function(box){if(assert(null!==box,"ARGraph.deleteBox: box !== null FAILED"),box.hasOwner()){var parent=box.parent,children=box.childBoxes,i=children.length;for(parent&&parent.removeChild(box);i--;)this.deleteBox(children[i]);this._deleteBoxAndPortEdges(box),box.owner=null,assert(void 0!==this.boxes[box.id],"ARGraph.remove: Box does not exist"),delete this.boxes[box.id]}box.destroy(),box=null},AutoRouterGraph.prototype.shiftBoxBy=function(box,offset){assert(null!==box,"ARGraph.shiftBoxBy: box !== null FAILED"),assert(!!this.boxes[box.id],"ARGraph.shiftBoxBy: Box does not exist!");var rect=this.box2bufferBox[box.id].box,children=box.childBoxes;this._disconnectPathsClipping(rect),this._disconnectPathsFrom(box),this._deleteBoxAndPortEdges(box),box.shiftBy(offset),this._addBoxAndPortEdges(box),rect=box.rect,this._disconnectPathsClipping(rect);for(var i=children.length;i--;)this.shiftBoxBy(children[i],offset)},AutoRouterGraph.prototype.setBoxRect=function(box,rect){null!==box&&(this._deleteBoxAndPortEdges(box),box.setRect(rect),this._addBoxAndPortEdges(box),this._disconnectPathsClipping(rect))},AutoRouterGraph.prototype.routeSync=function(){var state={finished:!1};for(this._connectAllDisconnectedPaths();!state.finished;)state=this._optimize(state)},AutoRouterGraph.prototype.routeAsync=function(options){var self=this,updateFn=options.update||Utils.nop,firstFn=options.first||Utils.nop,callbackFn=options.callback||Utils.nop,time=options.time||5,optimizeFn=function(state){return _logger.info("Async optimization cycle started"),self.completelyConnected?(updateFn(self.paths),state.finished?(_logger.info("Async routing finished"),callbackFn(self.paths)):(state=self._optimize(state),setTimeout(optimizeFn,time,state))):(_logger.info("Async optimization interrupted"),setTimeout(startRouting,time))},startRouting=function(){_logger.info("Async routing started");var state={finished:!1};self._connectAllDisconnectedPaths(),setTimeout(optimizeFn,time,state)};_logger.info("Async routing triggered");var disconnected=this._quickConnectDisconnectedPaths();firstFn(disconnected),this._disconnectTempPaths(disconnected),setTimeout(startRouting,time)},AutoRouterGraph.prototype._quickConnectDisconnectedPaths=function(){for(var path,disconnected=[],i=this.paths.length;i--;)path=this.paths[i],path.isConnected()||(path.calculateStartEndPorts(),path.points=new ArPointListPath(path.startpoint,path.endpoint),disconnected.push(path));return disconnected},AutoRouterGraph.prototype._disconnectTempPaths=function(paths){for(var i=paths.length;i--;)paths[i].points=new ArPointListPath},AutoRouterGraph.prototype._optimize=function(options){var maxOperations=options.maxOperations||100,last=options.last||0,dm=options.dm||10,d=options.d||0,getState=function(finished){return{finished:finished||!maxOperations,maxOperations:maxOperations,last:last,dm:dm,d:d}};if(maxOperations>0){if(1===last)return getState(!0);maxOperations--,this._simplifyPaths()&&(last=1)}if(maxOperations>0){if(2===last)return getState(!0);if(maxOperations--,this.horizontal.blockScanBackward()){do maxOperations--;while(maxOperations>0&&this.horizontal.blockScanBackward());if(2>last||last>5)d=0;else if(++d>=dm)return getState(!0);last=2}}if(maxOperations>0){if(3===last)return getState(!0);if(maxOperations--,this.horizontal.blockScanForward()){do maxOperations--;while(maxOperations>0&&this.horizontal.blockScanForward());if(2>last||last>5)d=0;else if(++d>=dm)return getState(!0);last=3}}if(maxOperations>0){if(4===last)return getState(!0);if(maxOperations--,this.vertical.blockScanBackward()){do maxOperations--;while(maxOperations>0&&this.vertical.blockScanBackward());if(2>last||last>5)d=0;else if(++d>=dm)return getState(!0);last=4}}if(maxOperations>0){if(5===last)return getState(!0);if(maxOperations--,this.vertical.blockScanForward()){do maxOperations--;while(maxOperations>0&&this.vertical.blockScanForward());if(2>last||last>5)d=0;else if(++d>=dm)return getState(!0);last=5}}if(maxOperations>0){if(6===last)return getState(!0);maxOperations--,this.horizontal.blockSwitchWrongs()&&(last=6)}if(maxOperations>0){if(7===last)return getState(!0);maxOperations--,this.vertical.blockSwitchWrongs()&&(last=7)}return getState(0===last?!0:!1)},AutoRouterGraph.prototype.deletePath=function(path){if(assert(null!==path,"ARGraph.deletePath: path !== null FAILED"),path.hasOwner()){assert(path.owner===this,"ARGraph.deletePath: path.owner === this FAILED"),this.deleteEdges(path),path.owner=null;var index=this.paths.indexOf(path);assert(index>-1,"ARGraph.remove: Path does not exist"),this.paths.splice(index,1)}path.destroy()},AutoRouterGraph.prototype.clear=function(addBackSelfEdges){this._deleteAllPaths(),this._deleteAllBoxes(),this._deleteAllEdges(),addBackSelfEdges&&this._addSelfEdges()},AutoRouterGraph.prototype.addPath=function(isAutoRouted,startports,endports){var path=new AutoRouterPath;return path.setAutoRouting(isAutoRouted),path.setStartPorts(startports),path.setEndPorts(endports),this._add(path),path},AutoRouterGraph.prototype.isEdgeFixed=function(path,startpoint,endpoint){var d=Utils.getDir(endpoint.minus(startpoint)),h=Utils.isHorizontal(d),elist=this._getEdgeList(h),edge=elist.getEdge(path,startpoint,endpoint);return null!==edge?edge.getEdgeFixed()&&!edge.getEdgeCustomFixed():(assert(!1,"ARGraph.isEdgeFixed: FAILED"),!0)},AutoRouterGraph.prototype.destroy=function(){this.deleteAll(!1),this.horizontal.SetOwner(null),this.vertical.SetOwner(null)},AutoRouterGraph.prototype.assertValid=function(){var i,ids=Object.keys(this.boxes);for(i=this.boxes.length;i--;)this.assertValidBox(this.boxes[ids[i]]);for(i=this.paths.length;i--;)this._assertValidPath(this.paths[i]);this.horizontal.assertValid(),this.vertical.assertValid()},AutoRouterGraph.prototype.assertValidBox=function(box){box.assertValid(),assert(box.owner===this,"ARGraph.assertValidBox: box.owner === this FAILED"),assert(void 0!==this.boxes[box.id],"ARGraph.assertValidBox: this.boxes[box.id] !== undefined FAILED"),assert(this._containsRectEdges(box.rect),"Graph does not contain edges for box "+box.id)},AutoRouterGraph.prototype._containsRectEdges=function(rect){var len,start,end,topLeft=rect.getTopLeft(),bottomRight=rect.getBottomRight(),points=[],result=!0;points.push(topLeft),points.push(new ArPoint(bottomRight.x,topLeft.y)),points.push(bottomRight),points.push(new ArPoint(topLeft.x,bottomRight.y)),len=points.length;for(var i=0;len>i;i++)start=points[i],end=points[(i+1)%len],result=result&&this._containsEdge(start,end);return result},AutoRouterGraph.prototype._containsEdge=function(start,end){var dir;return dir=Utils.getDir(start.minus(end)),assert(Utils.isRightAngle(dir),"Edge is invalid: "+Utils.stringify(start)+" and "+Utils.stringify(end)),Utils.isHorizontal(dir)?this.horizontal.contains(start,end)||this.horizontal.contains(end,start):this.vertical.contains(start,end)||this.vertical.contains(end,start)},AutoRouterGraph.prototype._assertValidPath=function(path){assert(path.owner===this,"ARGraph.assertValidBox: box.owner === this FAILED"),path.assertValid()},AutoRouterGraph.prototype.dumpPaths=function(pos,c){_logger.debug("Paths dump pos "+pos+", c "+c);for(var i=0;i<this.paths.length;i++)_logger.debug(i+". Path: "),this.paths[i].getPointList().dumpPoints("DumpPaths")},AutoRouterGraph.prototype.dumpEdgeLists=function(){this.horizontal.dumpEdges("Horizontal edges:"),this.vertical.dumpEdges("Vertical edges:")},module.exports=AutoRouterGraph},{"./AutoRouter.Box":10,"./AutoRouter.Constants":11,"./AutoRouter.Edge":12,"./AutoRouter.EdgeList":13,"./AutoRouter.Logger":15,"./AutoRouter.Path":16,"./AutoRouter.Point":17,"./AutoRouter.PointList":18,"./AutoRouter.Port":19,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}],15:[function(require,module,exports){"use strict";var debug=require("debug"),LEVELS=["warn","debug","info"],Logger=function(name){for(var i=LEVELS.length;i--;)this[LEVELS[i]]=debug(name+":"+LEVELS[i])};module.exports=Logger},{debug:6}],16:[function(require,module,exports){"use strict";var assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),ArPoint=require("./AutoRouter.Point"),ArPointListPath=(require("./AutoRouter.Rect"),require("./AutoRouter.PointList")),AutoRouterPath=function(){this.id="None",this.owner=null,this.startpoint=null,this.endpoint=null,this.startports=null,this.endports=null,this.startport=null,this.endport=null,this.attributes=CONSTANTS.PathDefault,this.state=CONSTANTS.PathStateDefault,this.isAutoRoutingOn=!0,this.customPathData=[],this.customizationType="Points",this.pathDataToDelete=[],this.points=new ArPointListPath};AutoRouterPath.prototype.hasOwner=function(){return null!==this.owner},AutoRouterPath.prototype.setStartPorts=function(newPorts){this.startports=newPorts,this.startport&&this.calculateStartPorts()},AutoRouterPath.prototype.setEndPorts=function(newPorts){this.endports=newPorts,this.endport&&this.calculateEndPorts()},AutoRouterPath.prototype.clearPorts=function(){this.startpoint&&(this.startport.removePoint(this.startpoint),this.startpoint=null),this.endpoint&&(this.endport.removePoint(this.endpoint),this.endpoint=null),this.startport=null,this.endport=null},AutoRouterPath.prototype.getStartPort=function(){return assert(this.startports.length,"ARPort.getStartPort: Can't retrieve start port. from "+this.id),this.startport||this.calculateStartPorts(),this.startport},AutoRouterPath.prototype.getEndPort=function(){return assert(this.endports.length,"ARPort.getEndPort: Can't retrieve end port from "+this.id),this.endport||this.calculateEndPorts(),this.endport},AutoRouterPath.prototype.removePort=function(port){var removed=Utils.removeFromArrays(port,this.startports,this.endports);assert(removed,"Port was not removed from path start/end ports"),this.owner.disconnect(this)},AutoRouterPath.prototype.calculateStartEndPorts=function(){return{src:this.calculateStartPorts(),dst:this.calculateEndPorts()}},AutoRouterPath.prototype.calculateStartPorts=function(){var tgt,i,srcPorts=[];for(assert(this.startports.length>0,"ArPath.calculateStartEndPorts: this.startports cannot be empty!"),this.startport&&this.startport.hasPoint(this.startpoint)&&this.startport.removePoint(this.startpoint),i=this.startports.length;i--;)assert(this.startports[i].owner,"ARPath.calculateStartEndPorts: port "+this.startports[i].id+" has invalid this.owner!"),this.startports[i].isAvailable()&&srcPorts.push(this.startports[i]);if(0===srcPorts.length&&(srcPorts=this.startports),this.endport&&srcPorts.length>1)for(i=srcPorts.length;i--;)srcPorts[i]===this.endport&&srcPorts.splice(i,1);if(this.isAutoRouted()){var accumulatePortCenters=function(prev,current){var center=current.rect.getCenter();return prev.x+=center.x,prev.y+=center.y,prev};tgt=this.endports.reduce(accumulatePortCenters,new ArPoint(0,0)),tgt.x/=this.endports.length,tgt.y/=this.endports.length}else tgt=this.customPathData[0];this.startport=Utils.getOptimalPorts(srcPorts,tgt);var startdir=this.getStartDir(),startportHasLimited=!1,startportCanHave=!0;return startdir!==CONSTANTS.DirNone&&(startportHasLimited=this.startport.hasLimitedDirs(),startportCanHave=this.startport.canHaveStartEndPointOn(startdir,!0)),(startdir===CONSTANTS.DirNone||startportHasLimited&&!startportCanHave)&&(startdir=this.startport.getStartEndDirTo(tgt,!0)),this.startpoint=this.startport.createStartEndPointTo(tgt,startdir),this.startpoint.owner=this,this.startport},AutoRouterPath.prototype.calculateEndPorts=function(){var tgt,dstPorts=[],i=this.endports.length;for(assert(this.endports.length>0,"ArPath.calculateStartEndPorts: this.endports cannot be empty!"),this.endport&&this.endport.hasPoint(this.endpoint)&&this.endport.removePoint(this.endpoint);i--;)assert(this.endports[i].owner,"ARPath.calculateStartEndPorts: this.endport has invalid this.owner!"),this.endports[i].isAvailable()&&dstPorts.push(this.endports[i]);if(0===dstPorts.length&&(dstPorts=this.endports),this.startport&&dstPorts.length>1)for(i=dstPorts.length;i--;)dstPorts[i]===this.startport&&dstPorts.splice(i,1);if(this.isAutoRouted()){var accumulatePortCenters=function(prev,current){var center=current.rect.getCenter();return prev.x+=center.x,prev.y+=center.y,prev};tgt=this.startports.reduce(accumulatePortCenters,new ArPoint(0,0)),tgt.x/=this.startports.length,tgt.y/=this.startports.length}else tgt=this.customPathData[this.customPathData.length-1];this.endport=Utils.getOptimalPorts(dstPorts,tgt);var enddir=this.getEndDir(),startdir=this.getStartDir(),endportHasLimited=!1,endportCanHave=!0;return enddir!==CONSTANTS.DirNone&&(endportHasLimited=this.endport.hasLimitedDirs(),endportCanHave=this.endport.canHaveStartEndPointOn(enddir,!1)),(enddir===CONSTANTS.DirNone||endportHasLimited&&!endportCanHave)&&(enddir=this.endport.getStartEndDirTo(tgt,!1,this.startport===this.endport?startdir:CONSTANTS.DirNone)),this.endpoint=this.endport.createStartEndPointTo(tgt,enddir),this.endpoint.owner=this,this.endport},AutoRouterPath.prototype.isConnected=function(){return 0!==(this.state&CONSTANTS.PathStateConnected)},AutoRouterPath.prototype.addTail=function(pt){assert(!this.isConnected(),"ARPath.addTail: !this.isConnected() FAILED"),this.points.push(pt)},AutoRouterPath.prototype.deleteAll=function(){this.points=new ArPointListPath,this.state=CONSTANTS.PathStateDefault,this.clearPorts()},AutoRouterPath.prototype.getStartBox=function(){var port=this.startport||this.startports[0];return port.owner.getRootBox()},AutoRouterPath.prototype.getEndBox=function(){var port=this.endport||this.endports[0];return port.owner.getRootBox()},AutoRouterPath.prototype.getOutOfBoxStartPoint=function(hintDir){var startBoxRect=this.getStartBox();assert(hintDir!==CONSTANTS.DirSkew,"ARPath.getOutOfBoxStartPoint: hintDir !== CONSTANTS.DirSkew FAILED"),assert(this.points.length>=2,"ARPath.getOutOfBoxStartPoint: this.points.length >= 2 FAILED");var pos=0,p=new ArPoint(this.points[pos++]),d=Utils.getDir(this.points[pos].minus(p));return d===CONSTANTS.DirSkew&&(d=hintDir),assert(Utils.isRightAngle(d),"ARPath.getOutOfBoxStartPoint: Utils.isRightAngle (d) FAILED"),Utils.isHorizontal(d)?p.x=Utils.getRectOuterCoord(startBoxRect,d):p.y=Utils.getRectOuterCoord(startBoxRect,d),p},AutoRouterPath.prototype.getOutOfBoxEndPoint=function(hintDir){var endBoxRect=this.getEndBox();assert(hintDir!==CONSTANTS.DirSkew,"ARPath.getOutOfBoxEndPoint: hintDir !== CONSTANTS.DirSkew FAILED"),assert(this.points.length>=2,"ARPath.getOutOfBoxEndPoint: this.points.length >= 2 FAILED");var pos=this.points.length-1,p=new ArPoint(this.points[pos--]),d=Utils.getDir(this.points[pos].minus(p));return d===CONSTANTS.DirSkew&&(d=hintDir),assert(Utils.isRightAngle(d),"ARPath.getOutOfBoxEndPoint: Utils.isRightAngle (d) FAILED"),Utils.isHorizontal(d)?p.x=Utils.getRectOuterCoord(endBoxRect,d):p.y=Utils.getRectOuterCoord(endBoxRect,d),p},AutoRouterPath.prototype.simplifyTrivially=function(){if(assert(!this.isConnected(),"ARPath.simplifyTrivially: !isConnected() FAILED"),!(this.points.length<=2)){var pos=0,pos1=pos;assert(pos1!==this.points.length,"ARPath.simplifyTrivially: pos1 !== this.points.length FAILED");var p1=this.points[pos++],pos2=pos;assert(pos2!==this.points.length,"ARPath.simplifyTrivially: pos2 !== this.points.length FAILED");var p2=this.points[pos++],dir12=Utils.getDir(p2.minus(p1)),pos3=pos;assert(pos3!==this.points.length,"ARPath.simplifyTrivially: pos3 !== this.points.length FAILED");for(var p3=this.points[pos++],dir23=Utils.getDir(p3.minus(p2));;){if(dir12===CONSTANTS.DirNone||dir23===CONSTANTS.DirNone||dir12!==CONSTANTS.DirSkew&&dir23!==CONSTANTS.DirSkew&&(dir12===dir23||dir12===Utils.reverseDir(dir23))?(this.points.splice(pos2,1),pos--,pos3--,dir12=Utils.getDir(p3.minus(p1))):(pos1=pos2,p1=p2,dir12=dir23),pos===this.points.length)return;pos2=pos3,p2=p3,pos3=pos,p3=this.points[pos++],dir23=Utils.getDir(p3.minus(p2))}CONSTANTS.DEBUG&&this.assertValidPoints()}},AutoRouterPath.prototype.getPointList=function(){return this.points},AutoRouterPath.prototype.isPathClip=function(r,isStartOrEndRect){for(var tmp=this.points.getTailEdge(),a=tmp.start,b=tmp.end,pos=tmp.pos,i=0,numEdges=this.points.length-1;pos>=0;){if(!isStartOrEndRect||0!==i&&i!==numEdges-1){if(Utils.isLineClipRect(a,b,r))return!0}else if(Utils.isPointIn(a,r,1)&&Utils.isPointIn(b,r,1))return!0;tmp=this.points.getPrevEdge(pos,a,b),a=tmp.start,b=tmp.end,pos=tmp.pos,i++}return!1},AutoRouterPath.prototype.isFixed=function(){return 0!==(this.attributes&CONSTANTS.PathFixed)},AutoRouterPath.prototype.isMoveable=function(){return 0===(this.attributes&CONSTANTS.PathFixed)},AutoRouterPath.prototype.setState=function(s){assert(null!==this.owner,"ARPath.setState: this.owner !== null FAILED"),this.state=s,CONSTANTS.DEBUG&&this.assertValid()},AutoRouterPath.prototype.getEndDir=function(){var a=this.attributes&CONSTANTS.PathEndMask;
return a&CONSTANTS.PathEndOnTop?CONSTANTS.DirTop:a&CONSTANTS.PathEndOnRight?CONSTANTS.DirRight:a&CONSTANTS.PathEndOnBottom?CONSTANTS.DirBottom:a&CONSTANTS.PathEndOnLeft?CONSTANTS.DirLeft:CONSTANTS.DirNone},AutoRouterPath.prototype.getStartDir=function(){var a=this.attributes&CONSTANTS.PathStartMask;return a&CONSTANTS.PathStartOnTop?CONSTANTS.DirTop:a&CONSTANTS.PathStartOnRight?CONSTANTS.DirRight:a&CONSTANTS.PathStartOnBottom?CONSTANTS.DirBottom:a&CONSTANTS.PathStartOnLeft?CONSTANTS.DirLeft:CONSTANTS.DirNone},AutoRouterPath.prototype.setEndDir=function(pathEnd){this.attributes=(this.attributes&~CONSTANTS.PathEndMask)+pathEnd},AutoRouterPath.prototype.setStartDir=function(pathStart){this.attributes=(this.attributes&~CONSTANTS.PathStartMask)+pathStart},AutoRouterPath.prototype.setCustomPathPoints=function(points){this.customPathData=points,this.calculateStartEndPorts(),this.points=(new ArPointListPath).concat(points),this.points.unshift(this.startpoint),this.points.push(this.endpoint),this.setState(CONSTANTS.PathStateConnected)},AutoRouterPath.prototype.createCustomPath=function(){this.points.shift(),this.points.pop(),this.points.unshift(this.startpoint),this.points.push(this.endpoint),this.setState(CONSTANTS.PathStateConnected)},AutoRouterPath.prototype.removePathCustomizations=function(){this.customPathData=[]},AutoRouterPath.prototype.areTherePathCustomizations=function(){return 0!==this.customPathData.length},AutoRouterPath.prototype.isAutoRouted=function(){return this.isAutoRoutingOn},AutoRouterPath.prototype.setAutoRouting=function(arState){this.isAutoRoutingOn=arState},AutoRouterPath.prototype.destroy=function(){this.isConnected()&&(this.startport.removePoint(this.startpoint),this.endport.removePoint(this.endpoint))},AutoRouterPath.prototype.assertValid=function(){var i;for(assert(this.startports.length>0,"Path has no startports!"),assert(this.endports.length>0,"Path has no endports!"),i=this.startports.length;i--;)this.startports[i].assertValid();for(i=this.endports.length;i--;)this.endports[i].assertValid();if(this.isAutoRouted()&&this.isConnected()){assert(0!==this.points.length,"ARPath.assertValid: this.points.length !== 0 FAILED");var points=this.getPointList();points.assertValid()}this.startpoint&&assert(this.startport,"Path has a startpoint without a startport"),this.endpoint&&assert(this.endport,"Path has a endpoint without a endport"),assert(this.owner,"Path does not have owner!")},AutoRouterPath.prototype.assertValidPoints=function(){},module.exports=AutoRouterPath},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.PointList":18,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}],17:[function(require,module,exports){"use strict";var ArSize=require("./AutoRouter.Size"),ArPoint=function(x,y){void 0===x?(x=0,y=0):void 0===y&&(y=x.y,x=x.x),this.x=x,this.y=y};ArPoint.prototype.equals=function(otherPoint){return this.x===otherPoint.x&&this.y===otherPoint.y},ArPoint.prototype.shift=function(otherObject){return this.x+=otherObject.dx,this.y+=otherObject.dy,this},ArPoint.prototype.add=function(otherObject){otherObject instanceof ArSize?(this.x+=otherObject.cx,this.y+=otherObject.cy):otherObject instanceof ArPoint&&(this.x+=otherObject.x,this.y+=otherObject.y)},ArPoint.prototype.subtract=function(otherObject){otherObject instanceof ArSize?(this.x-=otherObject.cx,this.y-=otherObject.cy):otherObject instanceof ArPoint&&(this.x-=otherObject.x,this.y-=otherObject.y)},ArPoint.prototype.plus=function(otherObject){var objectCopy=null;return otherObject instanceof ArSize?(objectCopy=new ArPoint(this),objectCopy.add(otherObject)):otherObject instanceof ArPoint&&(objectCopy=new ArPoint(otherObject),objectCopy.x+=this.x,objectCopy.y+=this.y),objectCopy||void 0},ArPoint.prototype.minus=function(otherObject){var objectCopy=new ArPoint(otherObject);return otherObject.cx||otherObject.cy?objectCopy.subtract(this):(otherObject.x||otherObject.y)&&(objectCopy=new ArSize,objectCopy.cx=this.x-otherObject.x,objectCopy.cy=this.y-otherObject.y),objectCopy},ArPoint.prototype.assign=function(otherPoint){return this.x=otherPoint.x,this.y=otherPoint.y,this},ArPoint.prototype.toString=function(){return"("+this.x+", "+this.y+")"},module.exports=ArPoint},{"./AutoRouter.Size":21}],18:[function(require,module,exports){"use strict";var Logger=require("./AutoRouter.Logger"),assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),_logger=new Logger("AutoRouter.PointList"),ArPointListPath=function(){for(var i=arguments.length;i--;)this.unshift(arguments[i])};ArPointListPath.prototype=[],ArPointListPath.prototype.concat=function(list){var i,newPoints=new ArPointListPath;for(i=0;i<this.length;i++)newPoints.push(this[i]);for(i=0;i<list.length;i++)newPoints.push(list[i]);return newPoints},ArPointListPath.prototype.end=function(){return this[this.length-1]},ArPointListPath.prototype.getTailEdge=function(){if(this.length<2)return this.length;var pos=this.length-1,end=this[pos--],start=this[pos];return{pos:pos,start:start,end:end}},ArPointListPath.prototype.getPrevEdge=function(pos,start,end){return CONSTANTS.DEBUG&&this.AssertValidPos(pos),end=this[pos--],pos!==this.length&&(start=this[pos]),{pos:pos,start:start,end:end}},ArPointListPath.prototype.getEdge=function(pos,start,end){CONSTANTS.DEBUG&&this.AssertValidPos(pos),start=this[pos++],assert(pos<this.length,"ArPointListPath.getEdge: pos < this.length FAILED"),end=this[pos]},ArPointListPath.prototype.getTailEdgePtrs=function(){var start,end,pos=this.length;return this.length<2?{pos:pos}:(assert(--pos<this.length,"ArPointListPath.getTailEdgePtrs: --pos < this.length FAILED"),end=this[pos--],assert(pos<this.length,"ArPointListPath.getTailEdgePtrs: pos < this.length FAILED"),start=this[pos],{pos:pos,start:start,end:end})},ArPointListPath.prototype.getPrevEdgePtrs=function(pos){var start,end;return CONSTANTS.DEBUG&&this.AssertValidPos(pos),end=this[pos],pos-- >0&&(start=this[pos]),{pos:pos,start:start,end:end}},ArPointListPath.prototype.getStartPoint=function(pos){return CONSTANTS.DEBUG&&this.AssertValidPos(pos),this[pos]},ArPointListPath.prototype.getEndPoint=function(pos){return CONSTANTS.DEBUG&&this.AssertValidPos(pos),pos++,assert(pos<this.length,"ArPointListPath.getEndPoint: pos < this.length FAILED"),this[pos]},ArPointListPath.prototype.getPointBeforeEdge=function(pos){return CONSTANTS.DEBUG&&this.AssertValidPos(pos),pos--,pos===this.length?null:this[pos]},ArPointListPath.prototype.getPointAfterEdge=function(pos){return CONSTANTS.DEBUG&&this.AssertValidPos(pos),pos++,assert(pos<this.length,"ArPointListPath.getPointAfterEdge: pos < this.length FAILED"),pos++,pos===this.length?null:this[pos]},ArPointListPath.prototype.assertValid=function(msg){msg=msg||"";for(var i=this.length-1;i>0;i--)assert(!!this[i].minus,"Bad value at position "+i+" ("+Utils.stringify(this[i])+")"),assert(!!this[i-1].minus,"Bad value at position "+(i-1)+" ("+Utils.stringify(this[i-1])+")"),assert(Utils.isRightAngle(Utils.getDir(this[i-1].minus(this[i]))),msg+"\n	ArPointListPath contains skew edge:\n"+Utils.stringify(this))},ArPointListPath.prototype.assertValidPos=function(pos){assert(pos<this.length,"ArPointListPath.assertValidPos: pos < this.length FAILED")},ArPointListPath.prototype.dumpPoints=function(msg){msg+=", points dump begin:\n";for(var p,pos=0,i=0;pos<this.length;)p=this[pos++],msg+=i+".: ("+p.x+", "+p.y+")\n",i++;return msg+="points dump end.",_logger.debug(msg),msg},module.exports=ArPointListPath},{"./AutoRouter.Constants":11,"./AutoRouter.Logger":15,"./AutoRouter.Utils":22,assert:1}],19:[function(require,module,exports){"use strict";var assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),ArPoint=require("./AutoRouter.Point"),ArSize=require("./AutoRouter.Size"),ArRect=require("./AutoRouter.Rect"),AutoRouterPort=function(){this.id=null,this.owner=null,this.limitedDirections=!0,this.rect=new ArRect,this.attributes=CONSTANTS.PortDefault,this.points=[[],[],[],[]],this.selfPoints=[],this.availableArea=[],this.calculateSelfPoints()};AutoRouterPort.prototype.calculateSelfPoints=function(){this.selfPoints=[],this.selfPoints.push(new ArPoint(this.rect.getTopLeft())),this.selfPoints.push(new ArPoint(this.rect.right,this.rect.ceil)),this.selfPoints.push(new ArPoint(this.rect.right,this.rect.floor)),this.selfPoints.push(new ArPoint(this.rect.left,this.rect.floor)),this.resetAvailableArea()},AutoRouterPort.prototype.hasOwner=function(){return null!==this.owner},AutoRouterPort.prototype.isRectEmpty=function(){return this.rect.isRectEmpty()},AutoRouterPort.prototype.getCenter=function(){return this.rect.getCenterPoint()},AutoRouterPort.prototype.setRect=function(r){assert(r.getWidth()>=3&&r.getHeight()>=3,"ARPort.setRect: r.getWidth() >= 3 && r.getHeight() >= 3 FAILED!"),this.rect.assign(r),this.calculateSelfPoints(),this.resetAvailableArea()},AutoRouterPort.prototype.shiftBy=function(offset){assert(!this.rect.isRectEmpty(),"ARPort.shiftBy: !this.rect.isRectEmpty() FAILED!"),this.rect.add(offset),this.calculateSelfPoints(),this.shiftPoints(offset)},AutoRouterPort.prototype.isConnectToCenter=function(){return 0!==(this.attributes&CONSTANTS.PortConnectToCenter)},AutoRouterPort.prototype.hasLimitedDirs=function(){return this.limitedDirections},AutoRouterPort.prototype.setLimitedDirs=function(ltd){this.limitedDirections=ltd},AutoRouterPort.prototype.portOnWhichEdge=function(point){return Utils.onWhichEdge(this.rect,point)},AutoRouterPort.prototype.canHaveStartEndPointOn=function(dir,isStart){return assert(dir>=0&&3>=dir,"ARPort.canHaveStartEndPointOn: 0 <= dir && dir <= 3 FAILED!"),isStart&&(dir+=4),0!==(this.attributes&1<<dir)},AutoRouterPort.prototype.canHaveStartEndPoint=function(isStart){return 0!==(this.attributes&(isStart?CONSTANTS.PortStartOnAll:CONSTANTS.PortEndOnAll))},AutoRouterPort.prototype.canHaveStartEndPointHorizontal=function(isHorizontal){return 0!==(this.attributes&(isHorizontal?CONSTANTS.PortStartEndHorizontal:CONSTANTS.PortStartEndVertical))},AutoRouterPort.prototype.getStartEndDirTo=function(point,isStart,notthis){assert(!this.rect.isRectEmpty(),"ARPort.getStartEndDirTo: !this.rect.isRectEmpty() FAILED!"),notthis=notthis?notthis:CONSTANTS.DirNone;var offset=point.minus(this.rect.getCenterPoint()),dir1=Utils.getMajorDir(offset);if(dir1!==notthis&&this.canHaveStartEndPointOn(dir1,isStart))return dir1;var dir2=Utils.getMinorDir(offset);if(dir2!==notthis&&this.canHaveStartEndPointOn(dir2,isStart))return dir2;var dir3=Utils.reverseDir(dir2);if(dir3!==notthis&&this.canHaveStartEndPointOn(dir3,isStart))return dir3;var dir4=Utils.reverseDir(dir1);return dir4!==notthis&&this.canHaveStartEndPointOn(dir4,isStart)?dir4:this.canHaveStartEndPointOn(dir1,isStart)?dir1:this.canHaveStartEndPointOn(dir2,isStart)?dir2:this.canHaveStartEndPointOn(dir3,isStart)?dir3:this.canHaveStartEndPointOn(dir4,isStart)?dir4:CONSTANTS.DirTop},AutoRouterPort.prototype.roundToHalfGrid=function(left,right){var btwn=(left+right)/2;return assert(btwn<Math.max(left,right)&&btwn>Math.min(left,right),"roundToHalfGrid: btwn variable not between left, right values. Perhaps box/connectionArea is too small?"),btwn},AutoRouterPort.prototype.createStartEndPointTo=function(point,dir){var resultPoint,dx=point.x-this.getCenter().x,dy=point.y-this.getCenter().y,pathAngle=Math.atan2(-dy,dx),k=0,maxX=this.rect.right,maxY=this.rect.floor,minX=this.rect.left,minY=this.rect.ceil,smallerPt=new ArPoint(minX,minY),largerPt=new ArPoint(maxX,maxY);switch(Utils.isHorizontal(dir)?(minX++,maxX--):(minY++,maxY--),dir){case CONSTANTS.DirTop:pathAngle=2*Math.PI-(pathAngle+Math.PI/2),largerPt.y=this.rect.ceil;break;case CONSTANTS.DirRight:pathAngle=2*Math.PI-pathAngle,smallerPt.x=this.rect.right;break;case CONSTANTS.DirBottom:pathAngle-=Math.PI/2,smallerPt.y=this.rect.floor;break;case CONSTANTS.DirLeft:largerPt.x=this.rect.left}for(0>pathAngle&&(pathAngle+=2*Math.PI),pathAngle*=180/Math.PI;k<this.points[dir].length&&pathAngle>this.points[dir][k].pathAngle;)k++;this.points[dir].length&&(0===k?largerPt=new ArPoint(this.points[dir][k]):k!==this.points[dir].length?(smallerPt=new ArPoint(this.points[dir][k-1]),largerPt=new ArPoint(this.points[dir][k])):smallerPt=new ArPoint(this.points[dir][k-1])),resultPoint=new ArPoint((largerPt.x+smallerPt.x)/2,(largerPt.y+smallerPt.y)/2),resultPoint.pathAngle=pathAngle;for(var start,end,i=this.availableArea.length,closestArea=0,distance=1/0;i--;){if(start=this.availableArea[i][0],end=this.availableArea[i][1],Utils.isOnEdge(start,end,resultPoint)){closestArea=-1;break}Utils.distanceFromLine(resultPoint,start,end)<distance&&(closestArea=i,distance=Utils.distanceFromLine(resultPoint,start,end))}if(-1!==closestArea&&this.isAvailable()){var dir2=Utils.getDir(this.availableArea[closestArea][0].minus(resultPoint));assert(Utils.isRightAngle(dir2),"AutoRouterPort.createStartEndPointTo: Utils.isRightAngle(dir2) FAILED"),dir2===CONSTANTS.DirLeft||dir2===CONSTANTS.DirTop?largerPt=this.availableArea[closestArea][1]:smallerPt=this.availableArea[closestArea][0],resultPoint=new ArPoint((largerPt.x+smallerPt.x)/2,(largerPt.y+smallerPt.y)/2)}return this.points[dir].splice(k,0,resultPoint),assert(Utils.isRightAngle(this.portOnWhichEdge(resultPoint)),"AutoRouterPort.createStartEndPointTo: Utils.isRightAngle(this.portOnWhichEdge(resultPoint)) FAILED"),resultPoint},AutoRouterPort.prototype.removePoint=function(pt){var removed;removed=Utils.removeFromArrays.apply(null,[pt].concat(this.points))},AutoRouterPort.prototype.hasPoint=function(pt){for(var k,i=0;4>i;){if(k=this.points[i].indexOf(pt),k>-1)return!0;i++}return!1},AutoRouterPort.prototype.shiftPoints=function(shift){for(var s=this.points.length;s--;)for(var i=this.points[s].length;i--;)this.points[s][i].add(shift)},AutoRouterPort.prototype.getPointCount=function(){for(var i=0,count=0;4>i;)count+=this.points[i++].length;return count},AutoRouterPort.prototype.resetAvailableArea=function(){this.availableArea=[],this.canHaveStartEndPointOn(CONSTANTS.DirTop)&&this.availableArea.push([this.rect.getTopLeft(),new ArPoint(this.rect.right,this.rect.ceil)]),this.canHaveStartEndPointOn(CONSTANTS.DirRight)&&this.availableArea.push([new ArPoint(this.rect.right,this.rect.ceil),this.rect.getBottomRight()]),this.canHaveStartEndPointOn(CONSTANTS.DirBottom)&&this.availableArea.push([new ArPoint(this.rect.left,this.rect.floor),this.rect.getBottomRight()]),this.canHaveStartEndPointOn(CONSTANTS.DirLeft)&&this.availableArea.push([this.rect.getTopLeft(),new ArPoint(this.rect.left,this.rect.floor)])},AutoRouterPort.prototype.adjustAvailableArea=function(r){if(this.rect.touching(r))for(var intersection,line,i=this.availableArea.length;i--;)Utils.isLineClipRect(this.availableArea[i][0],this.availableArea[i][1],r)&&(line=this.availableArea.splice(i,1)[0],intersection=Utils.getLineClipRectIntersect(line[0],line[1],r),intersection[0].equals(line[0])||this.availableArea.push([line[0],intersection[0]]),intersection[1].equals(line[1])||this.availableArea.push([intersection[1],line[1]]))},AutoRouterPort.prototype.getTotalAvailableArea=function(){for(var i=this.availableArea.length,length=new ArSize;i--;)length.add(this.availableArea[i][1].minus(this.availableArea[i][0]));return assert(0===length.cx||0===length.cy,"ARPort.getTotalAvailableArea: length[0] === 0 || length[1] === 0 FAILED"),length.cx||length.cy},AutoRouterPort.prototype.isAvailable=function(){return this.availableArea.length>0},AutoRouterPort.prototype.assertValid=function(){var point;assert(this.owner,"Port "+this.id+" does not have valid owner!");for(var s=this.points.length;s--;)for(var i=this.points[s].length;i--;)point=this.points[s][i],assert(Utils.isRightAngle(this.portOnWhichEdge(point)),"AutoRouterPort.createStartEndPointTo: Utils.isRightAngle(this.portOnWhichEdge(resultPoint)) FAILED")},AutoRouterPort.prototype.destroy=function(){this.owner=null;for(var point,path,i=this.points.length;i--;)for(var j=this.points[i].length;j--;)point=this.points[i][j],path=point.owner,assert(path,"start/end point does not have an owner!"),path.removePort(this);this.points=[[],[],[],[]]},module.exports=AutoRouterPort},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Rect":20,"./AutoRouter.Size":21,"./AutoRouter.Utils":22,assert:1}],20:[function(require,module,exports){"use strict";var ArPoint=(require("debug"),require("./AutoRouter.Point")),ArSize=require("./AutoRouter.Size"),Logger=require("./AutoRouter.Logger"),_logger=new Logger("AutoRouter.Rect"),ArRect=function(Left,Ceil,Right,Floor){if(void 0===Left)Left=0,Ceil=0,Right=0,Floor=0;else if(void 0===Ceil&&Left instanceof ArRect)Ceil=Left.ceil,Right=Left.right,Floor=Left.floor,Left=Left.left;else if(void 0===Right&&Left instanceof ArPoint)if(Ceil instanceof ArSize)Right=Left.x+Ceil.cx,Floor=Left.y+Ceil.cy,Ceil=Left.y,Left=Left.x;else{if(!(Left instanceof ArPoint&&Ceil instanceof ArPoint))throw new Error("Invalid ArRect Constructor");Right=Math.round(Ceil.x),Floor=Math.round(Ceil.y),Ceil=Math.round(Left.y),Left=Math.round(Left.x)}else if(void 0===Floor)throw new Error("Invalid ArRect Constructor");this.left=Math.round(Left),this.ceil=Math.round(Ceil),this.floor=Math.round(Floor),this.right=Math.round(Right)};ArRect.prototype.getCenter=function(){return{x:(this.left+this.right)/2,y:(this.ceil+this.floor)/2}},ArRect.prototype.getWidth=function(){return this.right-this.left},ArRect.prototype.getHeight=function(){return this.floor-this.ceil},ArRect.prototype.getSize=function(){return new ArSize(this.getWidth(),this.getHeight())},ArRect.prototype.getTopLeft=function(){return new ArPoint(this.left,this.ceil)},ArRect.prototype.getBottomRight=function(){return new ArPoint(this.right,this.floor)},ArRect.prototype.getCenterPoint=function(){return new ArPoint(this.left+this.getWidth()/2,this.ceil+this.getHeight()/2)},ArRect.prototype.isRectEmpty=function(){return this.left>=this.right&&this.ceil>=this.floor?!0:!1},ArRect.prototype.isRectNull=function(){return 0===this.left&&0===this.right&&0===this.ceil&&0===this.floor?!0:!1},ArRect.prototype.ptInRect=function(pt){return pt instanceof Array&&(pt=pt[0]),pt.x>=this.left&&pt.x<=this.right&&pt.y>=this.ceil&&pt.y<=this.floor?!0:!1},ArRect.prototype.setRect=function(nLeft,nCeil,nRight,nFloor){void 0===nCeil&&nLeft instanceof ArRect?this.assign(nLeft):void 0===nRight||void 0===nFloor?_logger.debug("Invalid args for [ArRect].setRect"):(this.left=nLeft,this.ceil=nCeil,this.right=nRight,this.floor=nFloor)},ArRect.prototype.setRectEmpty=function(){this.ceil=0,this.right=0,this.floor=0,this.left=0},ArRect.prototype.inflateRect=function(x,y){void 0!==x&&void 0!==x.cx&&void 0!==x.cy?(y=x.cy,x=x.cx):void 0===y&&(y=x),this.left-=x,this.right+=x,this.ceil-=y,this.floor+=y},ArRect.prototype.deflateRect=function(x,y){void 0!==x&&void 0!==x.cx&&void 0!==x.cy&&(y=x.cy,x=x.cx),this.left+=x,this.right-=x,this.ceil+=y,this.floor-=y},ArRect.prototype.normalizeRect=function(){var temp;this.left>this.right&&(temp=this.left,this.left=this.right,this.right=temp),this.ceil>this.floor&&(temp=this.ceil,this.ceil=this.floor,this.floor=temp)},ArRect.prototype.assign=function(rect){this.ceil=rect.ceil,this.right=rect.right,this.floor=rect.floor,this.left=rect.left},ArRect.prototype.equals=function(rect){return this.left===rect.left&&this.right===rect.right&&this.ceil===rect.ceil&&this.floor===rect.floor?!0:!1},ArRect.prototype.add=function(ArObject){var dx,dy;ArObject instanceof ArPoint?(dx=ArObject.x,dy=ArObject.y):void 0!==ArObject.cx&&void 0!==ArObject.cy?(dx=ArObject.cx,dy=ArObject.cy):_logger.debug("Invalid arg for [ArRect].add method"),this.left+=dx,this.right+=dx,this.ceil+=dy,this.floor+=dy},ArRect.prototype.subtract=function(ArObject){ArObject instanceof ArPoint?this.deflateRect(ArObject.x,ArObject.y):ArObject instanceof ArSize?this.deflateRect(ArObject):ArObject instanceof ArRect?(this.left+=ArObject.left,this.right-=ArObject.right,this.ceil+=ArObject.ceil,this.floor-=ArObject.floor):_logger.debug("Invalid arg for [ArRect].subtract method")},ArRect.prototype.plus=function(ArObject){var resObject=new ArRect(this);return resObject.add(ArObject),resObject},ArRect.prototype.minus=function(ArObject){var resObject=new ArRect(this);return resObject.subtract(ArObject),resObject},ArRect.prototype.unionAssign=function(rect){if(!rect.isRectEmpty()){if(this.isRectEmpty())return void this.assign(rect);this.left=Math.min(this.left,rect.left),this.right=Math.max(this.right,rect.right),this.ceil=Math.min(this.ceil,rect.ceil),this.floor=Math.max(this.floor,rect.floor)}},ArRect.prototype.union=function(rect){var resRect=new ArRect(this);return resRect.unionAssign(rect),resRect},ArRect.prototype.intersectAssign=function(rect1,rect2){return rect2=rect2?rect2:this,this.left=Math.max(rect1.left,rect2.left),this.right=Math.min(rect1.right,rect2.right),this.ceil=Math.max(rect1.ceil,rect2.ceil),this.floor=Math.min(rect1.floor,rect2.floor),this.left>=this.right||this.ceil>=this.floor?(this.setRectEmpty(),!1):!0},ArRect.prototype.intersect=function(rect){var resRect=new ArRect(this);return resRect.intersectAssign(rect),resRect},ArRect.prototype.touching=function(rect){return Math.max(rect.left,this.left)<=Math.min(rect.right,this.right)+1&&Math.max(rect.ceil,this.ceil)<=Math.min(rect.floor,this.floor)+1},ArRect.prototype.onCorner=function(point){var onHorizontalSide,onVerticalSide;return onHorizontalSide=point.x===this.left||point.x===this.right,onVerticalSide=point.y===this.ceil||point.y===this.floor,onHorizontalSide&&onVerticalSide},ArRect.prototype.toString=function(){return this.getTopLeft().toString()+" "+this.getBottomRight().toString()},module.exports=ArRect},{"./AutoRouter.Logger":15,"./AutoRouter.Point":17,"./AutoRouter.Size":21,debug:6}],21:[function(require,module,exports){"use strict";var ArSize=function(x,y){void 0===x?(x=0,y=0):void 0===y&&(y=x.cy,x=x.cx),this.cx=x,this.cy=y};ArSize.prototype.equals=function(otherSize){return this.cx===otherSize.cx&&this.cy===otherSize.cy?!0:!1},ArSize.prototype.add=function(otherSize){(otherSize.cx||otherSize.cy)&&(this.cx+=otherSize.cx,this.cy+=otherSize.cy),(otherSize.x||otherSize.y)&&(this.cx+=otherSize.x,this.cy+=otherSize.y)},ArSize.prototype.getArray=function(){var res=[];return res.push(this.cx),res.push(this.cy),res},module.exports=ArSize},{}],22:[function(require,module,exports){"use strict";var CONSTANTS=require("./AutoRouter.Constants"),assert=require("assert"),ArRect=require("./AutoRouter.Rect"),ArPoint=require("./AutoRouter.Point"),_getOptimalPorts=function(ports,tgt){function createPriority(port,center){var priority=0,point=[port.rect.getCenter().x-center.x,port.rect.getCenter().y-center.y],lineCount=port.getPointCount()||1,density=port.getTotalAvailableArea()/lineCount/maxArea||1,major=Math.abs(vector[0])>Math.abs(vector[1])?0:1,minor=(major+1)%2;return point[major]>0==vector[major]>0&&0===point[major]==(0===vector[major])&&(priority=Math.abs(vector[major])/Math.abs(vector[major]-point[major])*25),point[minor]>0==vector[minor]>0&&0===point[minor]==(0===vector[minor])&&(priority+=vector[minor]!==point[minor]?Math.abs(vector[minor])/Math.abs(vector[minor]-point[minor])*1:0),priority*=density}var vector,port,sPoint,i,srcC=new ArPoint,maxP=-(1/0),maxArea=0;for(i=0;i<ports.length;i++)sPoint=ports[i].rect.getCenter(),srcC.x+=sPoint.x,srcC.y+=sPoint.y,maxArea<ports[i].getTotalAvailableArea()&&(maxArea=ports[i].getTotalAvailableArea());srcC.x=srcC.x/ports.length,srcC.y=srcC.y/ports.length,vector=tgt.minus(srcC).getArray();var priority;for(i=0;i<ports.length;i++)priority=createPriority(ports[i],srcC)||0,priority>=maxP&&(port=ports[i],maxP=priority);return assert(port.owner,"ARGraph.getOptimalPorts: port has invalid owner"),port},_getPointCoord=function(point,horDir){return horDir===!0||_isHorizontal(horDir)?point.x:point.y},_inflatedRect=function(rect,a){var r=rect;return r.inflateRect(a,a),r},_isPointNear=function(p1,p2,nearness){return p2.x-nearness<=p1.x&&p1.x<=p2.x+nearness&&p2.y-nearness<=p1.y&&p1.y<=p2.y+nearness},_isPointIn=function(point,rect,nearness){var tmpR=new ArRect(rect);return tmpR.inflateRect(nearness,nearness),tmpR.ptInRect(point)===!0},_isRectIn=function(r1,r2){return r2.left<=r1.left&&r1.right<=r2.right&&r2.ceil<=r1.ceil&&r1.floor<=r2.floor},_isRectClip=function(r1,r2){var rect=new ArRect;return rect.intersectAssign(r1,r2)===!0},_distanceFromHLine=function(p,x1,x2,y){return assert(x2>=x1,"ArHelper.distanceFromHLine: x1 <= x2 FAILED"),Math.max(Math.abs(p.y-y),Math.max(x1-p.x,p.x-x2))},_distanceFromVLine=function(p,y1,y2,x){return assert(y2>=y1,"ArHelper.distanceFromVLine: y1 <= y2 FAILED"),Math.max(Math.abs(p.x-x),Math.max(y1-p.y,p.y-y2))},_distanceFromLine=function(pt,start,end){var dir=_getDir(end.minus(start));return _isHorizontal(dir)?_distanceFromVLine(pt,start.y,end.y,start.x):_distanceFromHLine(pt,start.x,end.x,start.y)},_isOnEdge=function(start,end,pt){if(start.x===end.x){if(end.x===pt.x&&pt.y<=Math.max(end.y,start.y)&&pt.y>=Math.min(end.y,start.y))return!0}else if(start.y===end.y&&start.y===pt.y&&pt.x<=Math.max(end.x,start.x)&&pt.x>=Math.min(end.x,start.x))return!0;return!1},_isPointNearLine=function(point,start,end,nearness){if(assert(nearness>=0,"ArHelper.isPointNearLine: 0 <= nearness FAILED"),end.x===start.x&&end.y===start.y)return!1;var point2=point;point2.subtract(start);var end2=end;end2.subtract(start);var x=end2.x,y=end2.y,u=point2.x,v=point2.y,xuyv=x*u+y*v,x2y2=x*x+y*y;if(0>xuyv||xuyv>x2y2)return!1;var expr1=x*v-y*u;expr1*=expr1;var expr2=nearness*nearness*x2y2;return expr2>=expr1},_isLineMeetHLine=function(start,end,x1,x2,y){if(assert(x2>=x1,"ArHelper.isLineMeetHLine: x1 <= x2 FAILED"),start instanceof Array&&(start=start[0]),end instanceof Array&&(end=end[0]),!(start.y<=y&&y<=end.y||end.y<=y&&y<=start.y))return!1;var end2=new ArPoint(end);if(end2.subtract(start),x1-=start.x,x2-=start.x,y-=start.y,0===end2.y)return 0===y&&(0>=x1&&x2>=0||x1<=end2.x&&end2.x<=x2);var x=end2.x/end2.y*y;return x>=x1&&x2>=x},_isLineMeetVLine=function(start,end,y1,y2,x){if(assert(y2>=y1,"ArHelper.isLineMeetVLine: y1 <= y2  FAILED"),start instanceof Array&&(start=start[0]),end instanceof Array&&(end=end[0]),!(start.x<=x&&x<=end.x||end.x<=x&&x<=start.x))return!1;var end2=new ArPoint(end);if(end2.subtract(start),y1-=start.y,y2-=start.y,x-=start.x,0===end2.x)return 0===x&&(0>=y1&&y2>=0||y1<=end2.y&&end2.y<=y2);var y=end2.y/end2.x*x;return y>=y1&&y2>=y},_isLineClipRects=function(start,end,rects){for(var i=rects.length;i--;)if(_isLineClipRect(start,end,rects[i]))return!0;return!1},_isLineClipRect=function(start,end,rect){return rect.ptInRect(start)||rect.ptInRect(end)?!0:_isLineMeetHLine(start,end,rect.left,rect.right,rect.ceil)||_isLineMeetHLine(start,end,rect.left,rect.right,rect.floor)||_isLineMeetVLine(start,end,rect.ceil,rect.floor,rect.left)||_isLineMeetVLine(start,end,rect.ceil,rect.floor,rect.right)},_getLineClipRectIntersect=function(start,end,rect){var dir=_getDir(end.minus(start)),endpoints=[new ArPoint(start),new ArPoint(end)];return _isLineClipRect(start,end,rect)?(assert(_isRightAngle(dir),"ArHelper.getLineClipRectIntersect: _isRightAngle(dir) FAILED"),(dir===CONSTANTS.DirLeft||dir===CONSTANTS.DirTop)&&(dir=_reverseDir(dir),endpoints.push(endpoints.splice(0,1)[0])),_isPointInDirFrom(endpoints[0],rect.getTopLeft(),_reverseDir(dir))&&endpoints[0].assign(rect.getTopLeft()),_isPointInDirFrom(endpoints[1],rect.getBottomRight(),dir)&&endpoints[1].assign(rect.getBottomRight()),_isHorizontal(dir)?(endpoints[0].y=start.y,endpoints[1].y=end.y):(endpoints[0].x=start.x,endpoints[1].x=end.x),endpoints):null},_intersect=function(a1,a2,b1,b2){return Math.min(a1,a2)<=Math.max(b1,b2)&&Math.min(b1,b2)<=Math.max(a1,a2)},_isHorizontal=function(dir){return dir===CONSTANTS.DirRight||dir===CONSTANTS.DirLeft},_isVertical=function(dir){return dir===CONSTANTS.DirTop||dir===CONSTANTS.DirBottom},_isRightAngle=function(dir){return CONSTANTS.DirTop<=dir&&dir<=CONSTANTS.DirLeft},_areInRightAngle=function(dir1,dir2){return assert(_isRightAngle(dir1)&&_isRightAngle(dir2),"ArHelper.areInRightAngle: _isRightAngle(dir1) && _isRightAngle(dir2) FAILED"),_isHorizontal(dir1)===_isVertical(dir2)},_nextClockwiseDir=function(dir){return _isRightAngle(dir)?(dir+1)%4:dir},_prevClockwiseDir=function(dir){return _isRightAngle(dir)?(dir+3)%4:dir},_reverseDir=function(dir){return _isRightAngle(dir)?(dir+2)%4:dir},_stepOneInDir=function(point,dir){switch(assert(_isRightAngle(dir),"ArHelper.stepOnInDir: _isRightAngle(dir) FAILED"),dir){case CONSTANTS.DirTop:point.y--;break;case CONSTANTS.DirRight:point.x++;break;case CONSTANTS.DirBottom:point.y++;break;case CONSTANTS.DirLeft:point.x--}},_getChildRectOuterCoordFrom=function(bufferObject,inDir,point){var children=bufferObject.children,i=-1,box=null,res=_getRectOuterCoord(bufferObject.box,inDir);for(assert(_isRightAngle(inDir),"getChildRectOuterCoordFrom: _isRightAngle(inDir) FAILED"),assert(!_isPointInDirFrom(point,bufferObject.box,inDir),"getChildRectOuterCoordFrom: !isPointInDirFrom(point, bufferObject.box.rect, (inDir)) FAILED");++i<children.length;)_isPointInDirFrom(point,children[i],_reverseDir(inDir))&&_isPointBetweenSides(point,children[i],inDir)&&_isCoordInDirFrom(res,_getRectOuterCoord(children[i],_reverseDir(inDir)),inDir)&&(res=_getRectOuterCoord(children[i],_reverseDir(inDir)),box=children[i]);return{box:box,coord:res}},_getRectOuterCoord=function(rect,dir){assert(_isRightAngle(dir),"Utils.getRectOuterCoord: isRightAngle(dir) FAILED");var t=rect.ceil-1,r=rect.right+1,b=rect.floor+1,l=rect.left-1;switch(dir){case CONSTANTS.DirTop:return t;case CONSTANTS.DirRight:return r;case CONSTANTS.DirBottom:return b}return l},getDirTableIndex=function(offset){return 4*(offset.cx>=0)+2*(offset.cy>=0)+(Math.abs(offset.cx)>=Math.abs(offset.cy))},majorDirTable=[CONSTANTS.DirTop,CONSTANTS.DirLeft,CONSTANTS.DirBottom,CONSTANTS.DirLeft,CONSTANTS.DirTop,CONSTANTS.DirRight,CONSTANTS.DirBottom,CONSTANTS.DirRight],_getMajorDir=function(offset){return majorDirTable[getDirTableIndex(offset)]},minorDirTable=[CONSTANTS.DirLeft,CONSTANTS.DirTop,CONSTANTS.DirLeft,CONSTANTS.DirBottom,CONSTANTS.DirRight,CONSTANTS.DirTop,CONSTANTS.DirRight,CONSTANTS.DirBottom],_getMinorDir=function(offset){return minorDirTable[getDirTableIndex(offset)]},_exGetDirTableIndex=function(offset){var res=offset.cx>0?offset.cy>0?offset.cx>offset.cy?6:offset.cx<offset.cy?8:7:offset.cy<0?offset.cx>-offset.cy?4:offset.cx<-offset.cy?2:3:5:offset.cx<0?offset.cy>0?-offset.cx>offset.cy?12:-offset.cx<offset.cy?10:11:offset.cy<0?offset.cx<offset.cy?14:offset.cx>offset.cy?16:15:13:offset.cy>0?9:offset.cy<0?1:0;return res},exMajorDirTable=[CONSTANTS.DirNone,CONSTANTS.DirTop,CONSTANTS.DirTop,CONSTANTS.DirRight,CONSTANTS.DirRight,CONSTANTS.DirRight,CONSTANTS.DirRight,CONSTANTS.DirRight,CONSTANTS.DirBottom,CONSTANTS.DirBottom,CONSTANTS.DirBottom,CONSTANTS.DirLeft,CONSTANTS.DirLeft,CONSTANTS.DirLeft,CONSTANTS.DirLeft,CONSTANTS.DirLeft,CONSTANTS.DirTop],_exGetMajorDir=function(offset){return exMajorDirTable[_exGetDirTableIndex(offset)]},exMinorDirTable=[CONSTANTS.DirNone,CONSTANTS.DirNone,CONSTANTS.DirRight,CONSTANTS.DirTop,CONSTANTS.DirTop,CONSTANTS.DirNone,CONSTANTS.DirBottom,CONSTANTS.DirBottom,CONSTANTS.DirRight,CONSTANTS.DirNone,CONSTANTS.DirLeft,CONSTANTS.DirBottom,CONSTANTS.DirBottom,CONSTANTS.DirNone,CONSTANTS.DirTop,CONSTANTS.DirTop,CONSTANTS.DirLeft],_exGetMinorDir=function(offset){return exMinorDirTable[_exGetDirTableIndex(offset)]},_getDir=function(offset,nodir){return 0===offset.cx?0===offset.cy?nodir:offset.cy<0?CONSTANTS.DirTop:CONSTANTS.DirBottom:0===offset.cy?offset.cx>0?CONSTANTS.DirRight:CONSTANTS.DirLeft:CONSTANTS.DirSkew},_isPointInDirFromChildren=function(point,fromParent,dir){var children=fromParent.children,i=0;for(assert(_isRightAngle(dir),"isPointInDirFromChildren: _isRightAngle(dir) FAILED");i<children.length;){if(_isPointInDirFrom(point,children[i].rect,dir))return!0;++i}return!1},_isPointInDirFrom=function(point,from,dir){if(from instanceof ArRect){
var rect=from;switch(assert(_isRightAngle(dir),"ArHelper.isPointInDirFrom: _isRightAngle(dir) FAILED"),dir){case CONSTANTS.DirTop:return point.y<rect.ceil;case CONSTANTS.DirRight:return point.x>=rect.right;case CONSTANTS.DirBottom:return point.y>=rect.floor;case CONSTANTS.DirLeft:return point.x<rect.left}return!1}switch(assert(_isRightAngle(dir),"ArHelper.isPointInDirFrom: _isRightAngle(dir) FAILED"),dir){case CONSTANTS.DirTop:return point.y<=from.y;case CONSTANTS.DirRight:return point.x>=from.x;case CONSTANTS.DirBottom:return point.y>=from.y;case CONSTANTS.DirLeft:return point.x<=from.x}return!1},_isPointBetweenSides=function(point,rect,ishorizontal){return ishorizontal===!0||_isHorizontal(ishorizontal)?rect.ceil<=point.y&&point.y<rect.floor:rect.left<=point.x&&point.x<rect.right},_isCoordInDirFrom=function(coord,from,dir){return assert(_isRightAngle(dir),"ArHelper.isCoordInDirFrom: _isRightAngle(dir) FAILED"),from instanceof ArPoint&&(from=_getPointCoord(from,dir)),dir===CONSTANTS.DirTop||dir===CONSTANTS.DirLeft?from>=coord:coord>=from},_onWhichEdge=function(rect,point){return point.y===rect.ceil&&rect.left<point.x&&point.x<rect.right?CONSTANTS.DirTop:point.y===rect.floor&&rect.left<point.x&&point.x<rect.right?CONSTANTS.DirBottom:point.x===rect.left&&rect.ceil<point.y&&point.y<rect.floor?CONSTANTS.DirLeft:point.x===rect.right&&rect.ceil<point.y&&point.y<rect.floor?CONSTANTS.DirRight:CONSTANTS.DirNone},ArFindNearestLine=function(pt){this.point=pt,this.dist1=1/0,this.dist2=1/0};ArFindNearestLine.prototype.hLine=function(x1,x2,y){assert(x2>=x1,"ArFindNearestLine.hLine: x1 <= x2  FAILED");var d1=_distanceFromHLine(this.point,x1,x2,y),d2=Math.abs(this.point.y-y);return d1<this.dist1||d1===this.dist1&&d2<this.dist2?(this.dist1=d1,this.dist2=d2,!0):!1},ArFindNearestLine.prototype.vLine=function(y1,y2,x){assert(y2>=y1,"ArFindNearestLine.hLine: y1 <= y2 FAILED");var d1=_distanceFromVLine(this.point,y1,y2,x),d2=Math.abs(this.point.x-x);return d1<this.dist1||d1===this.dist1&&d2<this.dist2?(this.dist1=d1,this.dist2=d2,!0):!1},ArFindNearestLine.prototype.was=function(){return this.dist1<1/0&&this.dist2<1/0};var removeFromArrays=function(value){for(var index,array,removed=!1,i=arguments.length-1;i>0;i--)array=arguments[i],index=array.indexOf(value),-1!==index&&(array.splice(index,1),removed=!0);return removed},stringify=function(value){return JSON.stringify(value,function(key,value){return"owner"===key&&value?value.id||typeof value:value})},roundTrunc=function(value,places){value=+value;var scale=Math.pow(10,+places),fn="floor";return 0>value&&(fn="ceil"),Math[fn](value*scale)/scale},floatEquals=function(a,b){return b>a-.1&&a+.1>b},toArray=function(obj){for(var result=new Array(obj.length||0),i=0;void 0!==obj[i];)result[i]=obj[i++];return result},pick=function(keys,obj){for(var res={},i=keys.length;i--;)res[keys[i]]=obj[keys[i]];return res},nop=function(){},assert=function(cond,msg){if(!cond)throw new Error(msg||"Assert failed")};module.exports={onWhichEdge:_onWhichEdge,isCoordInDirFrom:_isCoordInDirFrom,isPointBetweenSides:_isPointBetweenSides,isPointInDirFrom:_isPointInDirFrom,isPointInDirFromChildren:_isPointInDirFromChildren,isPointIn:_isPointIn,isPointNear:_isPointNear,getDir:_getDir,exGetMinorDir:_exGetMinorDir,exGetMajorDir:_exGetMajorDir,exGetDirTableIndex:_exGetDirTableIndex,getMinorDir:_getMinorDir,getMajorDir:_getMajorDir,getRectOuterCoord:_getRectOuterCoord,getChildRectOuterCoordFrom:_getChildRectOuterCoordFrom,stepOneInDir:_stepOneInDir,reverseDir:_reverseDir,prevClockwiseDir:_prevClockwiseDir,nextClockwiseDir:_nextClockwiseDir,areInRightAngle:_areInRightAngle,isRightAngle:_isRightAngle,isHorizontal:_isHorizontal,intersect:_intersect,getLineClipRectIntersect:_getLineClipRectIntersect,isLineClipRect:_isLineClipRect,isLineClipRects:_isLineClipRects,isPointNearLine:_isPointNearLine,isOnEdge:_isOnEdge,distanceFromLine:_distanceFromLine,isRectClip:_isRectClip,isRectIn:_isRectIn,inflatedRect:_inflatedRect,getPointCoord:_getPointCoord,getOptimalPorts:_getOptimalPorts,ArFindNearestLine:ArFindNearestLine,removeFromArrays:removeFromArrays,stringify:stringify,floatEquals:floatEquals,roundTrunc:roundTrunc,toArray:toArray,nop:nop,assert:assert,pick:pick}},{"./AutoRouter.Constants":11,"./AutoRouter.Point":17,"./AutoRouter.Rect":20,assert:1}],23:[function(require,module,exports){"use strict";var assert=require("assert"),CONSTANTS=require("./AutoRouter.Constants"),Utils=require("./AutoRouter.Utils"),ArPoint=require("./AutoRouter.Point"),ArRect=require("./AutoRouter.Rect"),AutoRouterGraph=require("./AutoRouter.Graph"),AutoRouterBox=require("./AutoRouter.Box"),AutoRouterPort=require("./AutoRouter.Port"),AutoRouterPath=require("./AutoRouter.Path"),AutoRouter=function(){this.paths={},this.ports={},this.pCount=0,this.portId2Path={},this.portId2Box={},this.graph=new AutoRouterGraph},ArBoxObject=function(b,p){this.box=b,this.ports=p||{}};AutoRouter.prototype.clear=function(){this.graph.clear(!0),this.paths={},this.portId2Path={},this.ports={}},AutoRouter.prototype.destroy=function(){this.graph.destroy(),this.graph=null},AutoRouter.prototype._createBox=function(size){var x1=void 0!==size.x1?size.x1:size.x2-size.width,x2=void 0!==size.x2?size.x2:size.x1+size.width,y1=void 0!==size.y1?size.y1:size.y2-size.height,y2=void 0!==size.y2?size.y2:size.y1+size.height,box=this.graph.createBox(),rect=new ArRect(x1,y1,x2,y2);assert(void 0!==x1&&void 0!==x2&&void 0!==y1&&void 0!==y2,"Missing size info for box");var height=rect.getHeight(),width=rect.getWidth(),dx=Math.max((3-width)/2,0),dy=Math.max((3-height)/2,0);return rect.inflateRect(dx,dy),box.setRect(rect),box},AutoRouter.prototype.addBox=function(size){var boxObject,box=this._createBox(size),portsInfo=size.ports||{};boxObject=new ArBoxObject(box),this.graph.addBox(box);for(var portIds=Object.keys(portsInfo),i=portIds.length;i--;)this.addPort(boxObject,portsInfo[portIds[i]]);return this.portId2Path[box.id]={"in":[],out:[]},boxObject},AutoRouter.prototype.addPort=function(boxObject,portInfo){var port,container,rect,box=boxObject.box;port=this._createPort(portInfo,box);var id=this.getPortId(portInfo.id,boxObject);return port.id=id,this.portId2Path[id]={"in":[],out:[]},this.ports[id]=port,rect=new ArRect(port.rect),rect.inflateRect(3),container=this._createBox({x1:rect.left,x2:rect.right,y1:rect.ceil,y2:rect.floor}),box.addChild(container),container.addPort(port),boxObject.ports[port.id]=port,this.portId2Box[port.id]=boxObject,this.graph.addBox(container),port},AutoRouter.prototype.getPortId=function(id,box){var SPLITTER="__",boxObject=this.portId2Box[id]||box,boxObjectId=boxObject.box.id,uniqueId=boxObjectId+SPLITTER+id;return assert(id.toString,"Invalid Port Id! ("+id+")"),id=id.toString(),-1!==id.indexOf(boxObjectId+SPLITTER)?id:uniqueId},AutoRouter.prototype._createPort=function(connData,box){var arx1,arx2,ary1,ary2,_x1,_x2,_y1,_y2,horizontal,r,a1,a2,angles=connData.angles||[],attr=0,type="any",port=box.createPort(),rect=box.rect,connArea=connData.area,isStart=17,rightAngle=0,bottomAngle=90,leftAngle=180,topAngle=270;return connArea instanceof Array&&(isStart=17,"any"!==type&&(isStart-="start"===type?1:16),_x1=Math.min(connArea[0][0],connArea[1][0]),_x2=Math.max(connArea[0][0],connArea[1][0]),_y1=Math.min(connArea[0][1],connArea[1][1]),_y2=Math.max(connArea[0][1],connArea[1][1]),horizontal=_y1===_y2,_y1===_y2&&_x1===_x2&&(horizontal=Math.min(Math.abs(rect.ceil-_y1),Math.abs(rect.floor-_y2))<Math.min(Math.abs(rect.left-_x1),Math.abs(rect.right-_x2)),horizontal?(_x1-=1,_x2+=1):(_y1-=1,_y2+=1)),assert(horizontal||_x1===_x2,"AutoRouter:addBox Connection Area for box must be either horizontal or vertical"),arx1=_x1,arx2=_x2,ary1=_y1,ary2=_y2,horizontal?Math.abs(_y1-rect.ceil)<Math.abs(_y1-rect.floor)?(ary1=_y1+1,ary2=_y1+5,attr=CONSTANTS.PortStartOnTop+CONSTANTS.PortEndOnTop):(ary1=_y1-5,ary2=_y1-1,attr=CONSTANTS.PortStartOnBottom+CONSTANTS.PortEndOnBottom):Math.abs(_x1-rect.left)<Math.abs(_x1-rect.right)?(arx1+=1,arx2+=5,attr=CONSTANTS.PortStartOnLeft+CONSTANTS.PortEndOnLeft):(arx1-=5,arx2-=1,attr=CONSTANTS.PortStartOnRight+CONSTANTS.PortEndOnRight)),3>arx2-arx1&&(arx1-=2,arx2+=2),3>ary2-ary1&&(ary1-=2,ary2+=2),r=new ArRect(arx1,ary1,arx2,ary2),void 0!==angles[0]&&void 0!==angles[1]&&(a1=angles[0],a2=angles[1],attr=0,rightAngle>=a1&&a2>=rightAngle&&(attr+=CONSTANTS.PortStartOnRight+CONSTANTS.PortEndOnRight),topAngle>=a1&&a2>=topAngle&&(attr+=CONSTANTS.PortStartOnTop+CONSTANTS.PortEndOnTop),leftAngle>=a1&&a2>=leftAngle&&(attr+=CONSTANTS.PortStartOnLeft+CONSTANTS.PortEndOnLeft),bottomAngle>=a1&&a2>=bottomAngle&&(attr+=CONSTANTS.PortStartOnBottom+CONSTANTS.PortEndOnBottom)),port.setLimitedDirs(!1),port.attributes=attr,port.setRect(r),port},AutoRouter.prototype._removePortsMatching=function(port){var i,id=port.id,startPaths=this.portId2Path[id].out,endPaths=this.portId2Path[id]["in"],paths="";for(i=startPaths.length;i--;)assert(Utils.removeFromArrays(port,startPaths[i].startports),"Port "+port.id+" not removed from startports"),paths+=startPaths[i].id+", ";for(paths="",i=endPaths.length;i--;)assert(Utils.removeFromArrays(port,endPaths[i].endports),"Port "+port.id+" not removed from endports"),paths+=endPaths[i].id+", ";for(i=this.graph.paths.length;i--;)assert(-1===this.graph.paths[i].startports.indexOf(port),"port not removed from path startports! ("+this.graph.paths[i].id+")"),assert(-1===this.graph.paths[i].endports.indexOf(port),"port not removed from path endports!")},AutoRouter.prototype.removePort=function(port){var container=port.owner,id=port.id;assert(container.parent,"Port container should have a parent box!"),this.graph.deleteBox(container),this._removePortsMatching(port);var boxObject=this.portId2Box[id];assert(void 0!==boxObject,"Box Object not found for port ("+id+")!"),delete boxObject.ports[id],this.ports[id]=void 0,this.portId2Path[id]=void 0,this.portId2Box[id]=void 0},AutoRouter.prototype.addPath=function(params){for(var pathId=(this.pCount++).toString();pathId.length<6;)pathId="0"+pathId;return pathId="PATH_"+pathId,params.id=pathId,this._createPath(params),pathId};var unpackPortInfo=function(port){var ports=[];if(port instanceof AutoRouterPort)ports.push(port);else for(var ids=Object.keys(port),i=ids.length;i--;)assert(port[ids[i]]instanceof AutoRouterPort,"Invalid port option: "+port[i]),ports.push(port[ids[i]]);return assert(ports.length>0,"Did not receive valid start or end ports"),ports};AutoRouter.prototype._createPath=function(params){if(!params.src||!params.dst)throw"AutoRouter:_createPath missing source or destination ports";var srcPorts,dstPorts,path,i,id=params.id,autoroute=params.autoroute||!0,startDir=params.startDirection||params.start,endDir=params.endDirection||params.end;if(srcPorts=unpackPortInfo(params.src),dstPorts=unpackPortInfo(params.dst),path=this.graph.addPath(autoroute,srcPorts,dstPorts),startDir||endDir){var start=void 0!==startDir?(-1!==startDir.indexOf("top")?CONSTANTS.PathStartOnTop:0)+(-1!==startDir.indexOf("bottom")?CONSTANTS.PathStartOnBottom:0)+(-1!==startDir.indexOf("left")?CONSTANTS.PathStartOnLeft:0)+(-1!==startDir.indexOf("right")?CONSTANTS.PathStartOnRight:0)||(-1!==startDir.indexOf("all")?CONSTANTS.PathDefault:0):CONSTANTS.PathDefault,end=void 0!==endDir?(-1!==endDir.indexOf("top")?CONSTANTS.PathEndOnTop:0)+(-1!==endDir.indexOf("bottom")?CONSTANTS.PathEndOnBottom:0)+(-1!==endDir.indexOf("left")?CONSTANTS.PathEndOnLeft:0)+(-1!==endDir.indexOf("right")?CONSTANTS.PathEndOnRight:0)||(-1!==endDir.indexOf("all")?CONSTANTS.PathDefault:0):CONSTANTS.PathDefault;path.setStartDir(start),path.setEndDir(end)}else path.setStartDir(CONSTANTS.PathDefault),path.setEndDir(CONSTANTS.PathDefault);for(path.id=id,this.paths[id]=path,i=srcPorts.length;i--;)this.portId2Path[srcPorts[i].id].out.push(path);for(i=dstPorts.length;i--;)this.portId2Path[dstPorts[i].id]["in"].push(path);return path},AutoRouter.prototype.routeSync=function(){this.graph.routeSync()},AutoRouter.prototype.routeAsync=function(options){this.graph.routeAsync(options)},AutoRouter.prototype.getPathPoints=function(pathId){assert(void 0!==this.paths[pathId],"AutoRouter:getPath requested path does not match any current paths");var path=this.paths[pathId];return path.points.map(function(point){return{x:point.x,y:point.y}})},AutoRouter.prototype.getBoxRect=function(boxId){assert(void 0!==this.graph.boxes[boxId],"AutoRouter:getBoxRect requested box does not match any current boxes");var rect=this.graph.boxes[boxId].rect;return Utils.pick(["left","right","ceil","floor"],rect)},AutoRouter.prototype.setBoxRect=function(boxObject,size){var box=boxObject.box,x1=void 0!==size.x1?size.x1:size.x2-size.width,x2=void 0!==size.x2?size.x2:size.x1+size.width,y1=void 0!==size.y1?size.y1:size.y2-size.height,y2=void 0!==size.y2?size.y2:size.y1+size.height,rect=new ArRect(x1,y1,x2,y2);this.graph.setBoxRect(box,rect)},AutoRouter.prototype._changePortId=function(oldId,newId){this.ports[newId]=this.ports[oldId],this.portId2Path[newId]=this.portId2Path[oldId],this.portId2Box[newId]=this.portId2Box[oldId],this.ports[newId].id=newId,this.ports[oldId]=void 0,this.portId2Path[oldId]=void 0,this.portId2Box[oldId]=void 0},AutoRouter.prototype.updatePort=function(boxObject,portInfo){var newPort,portId=this.getPortId(portInfo.id,boxObject),oldPort=this.ports[portId],tmpId="##TEMP_ID##",incomingPaths=this.portId2Path[portId]["in"],outgoingPaths=this.portId2Path[portId].out;this._changePortId(portId,tmpId),newPort=this.addPort(boxObject,portInfo);var path,i;for(i=outgoingPaths.length;i--;)path=outgoingPaths[i],path.startports.push(newPort),this.graph.disconnect(path),this.portId2Path[portId].out.push(path);for(i=incomingPaths.length;i--;)path=incomingPaths[i],path.endports.push(newPort),this.graph.disconnect(path),this.portId2Path[portId]["in"].push(path);return this.removePort(oldPort),boxObject.ports[portId]=newPort,newPort},AutoRouter.prototype.remove=function(item){assert(void 0!==item,"AutoRouter:remove Cannot remove undefined object");var i;if(item.box instanceof AutoRouterBox){var ports=Object.keys(item.ports);for(i=ports.length;i--;)this.portId2Path[ports[i]]=void 0;this.graph.deleteBox(item.box)}else{if(void 0===this.paths[item])throw"AutoRouter:remove Unrecognized item type. Must be an AutoRouterBox or an AutoRouterPath ID";if(this.paths[item]instanceof AutoRouterPath){var path,srcId,dstId,index;for(path=this.paths[item],i=path.startports.length;i--;)srcId=path.startports[i].id,index=this.portId2Path[srcId].out.indexOf(path),this.portId2Path[srcId].out.splice(index,1);for(i=path.endports.length;i--;)dstId=path.endports[i].id,index=this.portId2Path[dstId]["in"].indexOf(path),this.portId2Path[dstId]["in"].splice(index,1);this.graph.deletePath(path)}delete this.paths[item]}},AutoRouter.prototype.move=function(box,details){box=box instanceof AutoRouterBox?box:box.box;var dx=void 0!==details.dx?details.dx:Math.round(details.x-box.rect.left),dy=void 0!==details.dy?details.dy:Math.round(details.y-box.rect.ceil);assert(box instanceof AutoRouterBox,"AutoRouter:move First argument must be an AutoRouterBox or ArBoxObject"),this.graph.shiftBoxBy(box,{cx:dx,cy:dy})},AutoRouter.prototype.setMinimumGap=function(min){this.graph.setBuffer(Math.floor(min/2))},AutoRouter.prototype.setComponent=function(pBoxObj,chBoxObj){var parent=pBoxObj.box,child=chBoxObj.box;parent.addChild(child)},AutoRouter.prototype.setPathCustomPoints=function(args){var points,path=this.paths[args.path];if(void 0===path)throw"AutoRouter: Need to have an AutoRouterPath type to set custom path points";args.points.length>0?path.setAutoRouting(!1):path.setAutoRouting(!0),points=args.points.map(function(point){return new ArPoint(point[0],point[1])}),path.setCustomPathPoints(points)},AutoRouter.prototype._assertPortId2PathIsValid=function(){for(var id,path,j,i=this.graph.paths.length;i--;){for(path=this.graph.paths[i],j=path.startports.length;j--;)id=path.startports[j].id,assert(-1!==this.portId2Path[id].out.indexOf(path),"Port "+id+" is missing registered startport for "+path.id);for(j=path.endports.length;j--;)id=path.endports[j].id,assert(-1!==this.portId2Path[id]["in"].indexOf(path),"Port "+id+" is missing registered endport for "+path.id)}},module.exports=AutoRouter},{"./AutoRouter.Box":10,"./AutoRouter.Constants":11,"./AutoRouter.Graph":14,"./AutoRouter.Path":16,"./AutoRouter.Point":17,"./AutoRouter.Port":19,"./AutoRouter.Rect":20,"./AutoRouter.Utils":22,assert:1}]},{},[9])(9)});
